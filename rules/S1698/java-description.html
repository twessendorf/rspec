<div class="paragraph">
<p>It is equivalent to use the equality <code>==</code> operator and the <code>equals</code> method to compare two objects if the <code>equals</code> method inherited from <code>Object</code> has not been overridden. In this case both checks compare the object references.</p>
</div>
<div class="paragraph">
<p>But as soon as <code>equals</code> is overridden, two objects not having the same reference but having the same value can be equal. This rule spots suspicious uses of <code>==</code> and <code>!=</code> operators on objects whose <code>equals</code> methods are overridden.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>String firstName = getFirstName(); // String overrides equals
String lastName = getLastName();

if (firstName == lastName) { ... }; // Non-compliant; false even if the strings have the same value</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>String firstName = getFirstName();
String lastName = getLastName();

if (firstName != null &amp;&amp; firstName.equals(lastName)) { ... };</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comparing two instances of the <code>Class</code> object will not raise an issue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Class c;
if(c == Integer.class) { // No issue raised
}</pre>
</div>
</div>
<div class="paragraph">
<p>Comparing <code>Enum</code> will not raise an issue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public enum Fruit {
   APPLE, BANANA, GRAPE
}
public boolean isFruitGrape(Fruit candidateFruit) {
  return candidateFruit == Fruit.GRAPE; // it's recommended to activate S4551 to enforce comparison of Enums using ==
}</pre>
</div>
</div>
<div class="paragraph">
<p>Comparing with <code>final</code> reference will not raise an issue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>private static final Type DEFAULT = new Type();

void foo(Type other) {
  if (other == DEFAULT) { // Compliant
  //...
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Comparing with <code>this</code> will not raise an issue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  public boolean equals(Object other) {
    if (this == other) {  // Compliant
      return false;
    }
 }</pre>
</div>
</div>
<div class="paragraph">
<p>Comparing with <code>java.lang.String</code> and boxed types <code>java.lang.Integer</code>, &#8230;&#8203; will not raise an issue.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>S4973 - Strings and Boxed types should be compared using "equals()"</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/595.html">MITRE, CWE-595</a> - Comparison of Object References Instead of Object Contents</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/597.html">MITRE, CWE-597</a> - Use of Wrong Operator in String Comparison</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/UjdGBQ">CERT, EXP03-J.</a> - Do not use the equality operators when comparing values of boxed primitives</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/yDdGBQ">CERT, EXP50-J.</a> - Do not confuse abstract object equality with reference equality</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use the "equals" method if value comparison was intended.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s1127">deprecates: S1127</h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s4973">is related to: S4973</h3>

</div>
<div class="sect2">
<h3 id="_on_14_apr_2014_203957_ann_campbell_wrote">on 14 Apr 2014, 20:39:57 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Note that there is a separate, specific rule for string comparisons. Should this rule ignore strings?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_may_2014_151638_ann_campbell_wrote">on 20 May 2014, 15:16:38 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>In Python, the "==" operator is supposed to compare values, not identities.</p>
</div>
<div class="paragraph">
<p><a href="http://stackoverflow.com/a/1504742" class="bare">http://stackoverflow.com/a/1504742</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.rafekettler.com/magicmethods.html#operators" class="bare">http://www.rafekettler.com/magicmethods.html#operators</a></p>
</div>
<div class="paragraph">
<p>This rule therefore cannot be applied to Python.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_jun_2014_071729_nicolas_peru_wrote">on 13 Jun 2014, 07:17:29 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] String comparison rule works only for comparison with a String literal. I think that this rule should cover strings and once it is implemented the other one should be deprecated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_204052_sébastien_gioria_wrote">on 2 Feb 2015, 20:40:52 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>Rule : CERT  EXP03-J</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_203100_ann_campbell_wrote">on 3 Feb 2015, 20:31:00 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~sebastien.gioria]</p>
</div>
</div>
</div>
</div>