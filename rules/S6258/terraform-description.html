<div class="paragraph">
<p>Disabling logging of this component can lead to missing traceability in case of a security incident.</p>
</div>
<div class="paragraph">
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system&#8217;s events. The logging coverage enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
</div>
<div class="paragraph">
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This component is essential for the information system infrastructure.</p>
</li>
<li>
<p>This component is essential for mission-critical functions.</p>
</li>
<li>
<p>Compliance policies require this component to be monitored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable the logging capabilities of this component.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/s3/">Amazon S3 access requests</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_s3_bucket" "mynoncompliantbucket" { # Sensitive
  bucket = "mynoncompliantbucketname"
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a> stages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_api_gateway_stage" "api-v1" { # Sensitive
  deployment_id = aws_api_gateway_deployment.example.id
  rest_api_id   = aws_api_gateway_rest_api.example.id
  stage_name    = "v1-prod-api"
  xray_tracing_enabled = false # Sensitive
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/neptune/">Amazon Neptune</a> clusters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_neptune_cluster" "cluster" {
  enable_cloudwatch_logs_exports = []  # Sensitive
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> broker logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_msk_cluster" "sensitive_msk" {
  cluster_name = "sensitive_msk"
  logging_info {
    broker_logs { # Sensitive
      firehose {
        enabled = false
      }
      s3 {
        enabled = false
      }
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/amazon-mq/">Amazon MQ</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_mq_broker" "broker" {
  logs {  # Sensitive
    audit = false
    general = false
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/documentdb/">Amazon DocumentDB</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_docdb_cluster" "docdb_omitting_logs" { # Sensitive
  cluster_identifier = "DB Cluster Without Logs"
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/redshift/">Amazon Redshift</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_redshift_cluster" "cluster" {
  cluster_identifier = "redshift-cluster"

  logging {
    enable = false # Sensitive
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/global-accelerator/">Amazon Global Accelerator</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_globalaccelerator_accelerator" "accelerator" {
  attributes {
    flow_logs_enabled   = false  # Sensitive
    flow_logs_s3_bucket = "example-bucket"
    flow_logs_s3_prefix = "flow-logs/"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/opensearch-service/">Amazon OpenSearch</a> service, or Amazon Elasticsearch service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_elasticsearch_domain" "domain" {
  log_publishing_options {
    cloudwatch_log_group_arn = "arn:aws:logs:us-east-1:1234:log-group:es-audit-logs"
    log_type = "AUDIT_LOGS"
    enabled = false # Sensitive
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a> distributions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_cloudfront_distribution" "cloudfront_distribution" { # Sensitive
  default_root_object = "index.html"
}</pre>
</div>
</div>
<div class="paragraph">
<p>For both Amazon <a href="https://aws.amazon.com/elasticloadbalancing/classic-load-balancer/">Classic Load Balancing</a> and <a href="https://aws.amazon.com/elasticloadbalancing/application-load-balancer/">Application Load Balancing</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_lb" "load_balancer" {
  access_logs {
    enabled = false # Sensitive
    bucket = "mycompliantbucket"
    bucket_prefix = "log/lb-"
  }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/s3/">Amazon S3 access requests</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_s3_bucket" "myloggingbucket" {
  bucket = "myloggingbucketname"
  acl    = "log-delivery-write"
}

resource "aws_s3_bucket" "mycompliantbucket" {
  bucket = "mycompliantbucketname"

  logging {
      target_bucket = "myloggingbucketname"
      target_prefix = "log/mycompliantbucket"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a> stages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_api_gateway_stage" "api-v1" {
  deployment_id = aws_api_gateway_deployment.example.id
  rest_api_id   = aws_api_gateway_rest_api.example.id
  stage_name    = "v1-prod-api"
  xray_tracing_enabled = true
  access_log_settings {
    destination_arn = "arn:aws:logs:eu-west-1:123456789:test"
    format = "..."
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/neptune/">Amazon Neptune</a> clusters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_neptune_cluster" "cluster" {
  enable_cloudwatch_logs_exports = ["audit"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> broker logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_msk_cluster" "sensitive_msk" {
  cluster_name = "sensitive_msk"
  logging_info {
    broker_logs {
      firehose {
        enabled = false
      }
      s3 {
        enabled = true
        bucket  = "myloggingbucketname"
        prefix  = "log/msk-"
      }
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/amazon-mq/">Amazon MQ</a> enable <code>audit</code> or <code>general</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_mq_broker" "broker" {
  logs {
    audit = true
    general = true
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/documentdb/">Amazon DocumentDB</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_docdb_cluster" "docdb_omitting_logs" {
  cluster_identifier = "DB Cluster With Logs"
  enabled_cloudwatch_logs_exports = ["audit"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/redshift/">Amazon Redshift</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_redshift_cluster" "cluster" {
  cluster_identifier = "compliant-redshift-cluster"
  logging {
    enable           = true
    bucket_name      = "infra_logs"
    s3_key_prefix    = "log/redshift-"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/global-accelerator/">Amazon Global Accelerator</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_globalaccelerator_accelerator" "accelerator" {
  attributes {
    flow_logs_enabled   = true
    flow_logs_s3_bucket = "example-bucket"
    flow_logs_s3_prefix = "flow-logs/"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/opensearch-service/">Amazon OpenSearch</a> service, or Amazon Elasticsearch service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_elasticsearch_domain" "domain" {
  log_publishing_options {
    cloudwatch_log_group_arn = "arn:aws:logs:us-east-1:1234:log-group:es-audit-logs"
    log_type = "AUDIT_LOGS"
    enabled = true
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a> distributions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_cloudfront_distribution" "cloudfront_distribution" {
  default_root_object = "index.html"
  logging_config {
    bucket          = "mycompliantbucketname"
    prefix          = "log/cloudfront-"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For both Amazon <a href="https://aws.amazon.com/elasticloadbalancing/classic-load-balancer/">Classic Load Balancing</a> and <a href="https://aws.amazon.com/elasticloadbalancing/application-load-balancer/">Application Load Balancing</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "aws_lb" "load_balancer" {
  access_logs {
    enabled = true
    bucket = "mycompliantbucket"
    bucket_prefix = "log/lb-"
  }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">OWASP Top 10 2021 Category A9</a> - Security Logging and Monitoring Failures</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html">AWS Documentation</a> - Logging requests using server access logging</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/778.html">MITRE, CWE-778</a> - Insufficient Logging</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">OWASP Top 10 2017 Category A10</a> - Insufficient Logging and Monitoring</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that disabling logging is safe here.</p>
</div>
</div>
</div>
</div>