<div class="paragraph">
<p>User provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Constructing HTML content directly from tainted data enables attacker(s) to inject special crafted values to abuse template engine&#8217;s rendering process. Successful server side template injection (SSTI) attack can lead to arbitrary file read or operating system commands execution.</p>
</div>
<div class="paragraph">
<p>Template engine are used by web server to render rich HTML content, generally web pages or emails. Template injection usually happens when the template content has been dynamically generated from unvalidated user inputs.</p>
</div>
<div class="paragraph">
<p>This problem can be avoided by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using static template that are read from files rather than building templates dynamically</p>
</li>
<li>
<p>Using template variables to inject dynamic values at render time</p>
</li>
<li>
<p>Using template engine advanced control structure (like blocks or include) to dynamically build complex templates</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>from flask import request, render_template_string

# /hello?username={{config}} will display the entire flask configuration and potential secrets
@app.route('/hello')
def hello():
    username = request.args.get('username')
    template = f"&lt;p&gt;Hello {username}&lt;/p&gt;" # User input is used directly in the string to be rendered
    return render_template_string(template) # Noncompliant</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>from flask import request, render_template_string

@app.route('/hello')
def hello():
    username = request.args.get('username')
    template = "&lt;p&gt;Hello {{ name }}&lt;/p&gt;"
    return render_template_string(template, name=username) # Compliant</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/94.html">MITRE, CWE-94</a> - Improper Control of Generation of Code</p>
</li>
<li>
<p><a href="https://medium.com/@nyomanpradipta120/ssti-in-flask-jinja2-20b068fdaeee">SSTI in Flask/Jinja2</a></p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Refactor this code to not construct HTML content directly from tainted user-controlled data.</p>
</div>
</div>
</div>
</div>