<div class="paragraph">
<p>A call to the <code>fopen()</code>/<code>open()</code> function must be matched with a call to <code>fclose()</code>/<code>close</code>. Otherwise, you run the risk of using up all the OS&#8217;s file handles, which could lock up not just your program but potentially everything on the box.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>int fun() {
  FILE *f = fopen("file", "r");
  if (f == NULL) {
    return -1;
  }
  // ...
  return 0; // Noncompliant, file f has not been closed
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>int fun() {
  FILE *f = fopen("file", "r");
  if (f == NULL) {
    return -1;
  }
  // ...
  fclose(f);
  return 0;
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/459.html">MITRE, CWE-459</a> - Incomplete Cleanup</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/772.html">MITRE, CWE-772</a> - Missing Release of Resource after Effective Lifetime</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/vjdGBQ">CERT, FIO04-J.</a> - Release resources when they are no longer needed</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/QtUxBQ">CERT, FIO42-C.</a> - Close files when they are no longer needed</p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">Try With Resources</a></p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Review the data-flow; this file might not have been closed when reaching exit point at line <code>line</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: the open call, ex: fopen</p>
</li>
<li>
<p>Additional: statement exiting the function</p>
<div class="ulist">
<ul>
<li>
<p>Message: Exit point</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_30_mar_2016_164631_ann_campbell_wrote">on 30 Mar 2016, 16:46:31 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~massimo.paladin] I&#8217;ve expanded the description slightly with a 'why'.</p>
</div>
<div class="paragraph">
<p>Speaking of which, why downgrade this from Blocker to Critical?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2016_131153_ann_campbell_wrote">on 31 Mar 2016, 13:11:53 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~massimo.paladin] I&#8217;ve moved the Cert C reference back to the main task. All references go on every language-variation of a rule.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2016_131508_massimo_paladin_wrote">on 31 Mar 2016, 13:15:08 Massimo PALADIN wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] what about <code>Exceptions</code> section which is present on the main task but is not applicable to the language variation?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2016_132956_ann_campbell_wrote">on 31 Mar 2016, 13:29:56 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~massimo.paladin] I&#8217;ve moved that into a language-specific subtask</p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s5485">relates to: S5485</h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s3546">is related to: S3546</h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s2930">is related to: S2930</h3>

</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_142837_sébastien_gioria_wrote">on 2 Feb 2015, 14:28:37 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>Could be tag</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OWASP Top10 2013 A5 (Denial Of Service fall mostly in this category because finishing most the time in stacktrace of the JavaVM. )</p>
</li>
<li>
<p>CERT Secure Coding FIO04-J</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2015_131112_ann_campbell_wrote">on 4 Feb 2015, 13:11:12 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks for the CERT reference [~sebastien.gioria], but I don&#8217;t understand the OWASP tie.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_feb_2015_230232_freddy_mallet_wrote">on 11 Feb 2015, 23:02:32 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>This one can lead to a denial of service.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_apr_2015_075503_michael_gumowski_wrote">on 24 Apr 2015, 07:55:03 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>As for the moment we are not making cross-file or cross-method analysis (it is planned), we are not able to tell if it is the responsibility of the method to close a Closeable/AutoCloseable retrieved using method invocation. There is no existing annotation neither which would provide the information. I changed the non-compliant example and compliant solution to something that we can actually detect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_jun_2015_185732_ann_campbell_wrote">on 11 Jun 2015, 18:57:32 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski], would it be appropriate to map this rule to the CodePro rule <a href="https://developers.google.com/java-dev-tools/codepro/doc/features/audit/audit_rules_com.instantiations.assist.eclipse.auditGroup.possibleErrors#com.instantiations.assist.eclipse.audit.closeInFinally">Close In Finally</a>?</p>
</div>
<div class="paragraph">
<p>I&#8217;m asking first for an answer based on the current implementation.</p>
</div>
<div class="paragraph">
<p>And if that answer&#8217;s "no" my second question is whether we should go ahead &amp; do the mapping &amp; extend the implementation.</p>
</div>
<div class="paragraph">
<p>As a followup, there is also this CodePro rule: <a href="https://developers.google.com/java-dev-tools/codepro/doc/features/audit/audit_rules_com.instantiations.assist.eclipse.auditGroup.jdbc#com.instantiations.assist.eclipse.audit.closeOrder">Close Order</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_jun_2015_141804_ann_campbell_wrote">on 17 Jun 2015, 14:18:04 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>CodePro: Close In Finally</p>
</div>
</div>
</div>
</div>