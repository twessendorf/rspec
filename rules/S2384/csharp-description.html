<div class="paragraph">
<p>Mutable collections are those whose state can be changed. For instance, <code>Array</code> and <code>List&lt;T&gt;</code> are mutable, but <code>System.Collections.ObjectModel.ReadOnlyCollection&lt;T&gt;</code> and <code>System.Collections.Immutable.ImmutableList&lt;T&gt;</code> are not. Mutable collection class members should not be returned to a caller or accepted and stored directly. Doing so leaves you vulnerable to unexpected changes in your class state.</p>
</div>
<div class="paragraph">
<p>Instead use and store a copy of the mutable collection, or return an immutable collection wrapper, e.g. <code>System.Collections.ObjectModel.ReadOnlyCollection&lt;T&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Note that you can&#8217;t just return your mutable collection through the <code>IEnumerable&lt;T&gt;</code> interface because the caller of your method/property could cast it down to the mutable type and then change it.</p>
</div>
<div class="paragraph">
<p>This rule checks that mutable collections are not stored or returned directly.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>class A
{
    private List&lt;string&gt; names = new List&lt;string&gt;();

    public ICollection&lt;string&gt; Names =&gt; names; // Noncompliant

    public IEnumerable&lt;string&gt; GetNames()  // Noncompliant
    {
        return names;
    }

    public void SetNames(List&lt;string&gt; strings)
    {
        this.names = strings;  // Noncompliant
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>class A
{
    private List&lt;string&gt; names = new List&lt;string&gt;();
    private ReadOnlyCollection&lt;string&gt; readOnlyNames = new ReadOnlyCollection&lt;string&gt;(names);

    public ICollection&lt;string&gt; Names =&gt; readOnlyNames; // Return a collection wrapper

    public IEnumerable&lt;string&gt; GetNames()
    {
        names.ToList(); // Make a copy
    }

    public void SetNames(List&lt;string&gt; strings)
    {
        this.names.Clear();
        this.names.AddRange(strings); // Make a copy
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/374.html">MITRE, CWE-374</a> - Passing Mutable Objects to an Untrusted Method</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/375.html">MITRE, CWE-375</a> - Returning a Mutable Object to an Untrusted Caller</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>(Store|Return) a copy of "xxx" [or use an immutable "Collection"].</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_15_mar_2017_161335_amaury_levé_wrote">on 15 Mar 2017, 16:13:35 Amaury Levé wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I changed a bit this rule to focus only on collections for C# as <code>Date</code> is immutable for us.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_mar_2017_184709_ann_campbell_wrote">on 15 Mar 2017, 18:47:09 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Works for me [~amaury.leve]</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s1240">is duplicated by: S1240</h3>

</div>
<div class="sect2">
<h3 id="_on_27_jan_2015_205142_freddy_mallet_wrote">on 27 Jan 2015, 20:51:42 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>My comment on RSPEC-2385 is also relevant here, I would limit the scope of this rule to some known and widely used mutables objects. Moreover I would not activate this rule by default and would use the tag 'security'. Looks like we could link this rule to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>http://cwe.mitre.org/data/definitions/375.html</p>
</li>
<li>
<p>http://cwe.mitre.org/data/definitions/374.html</p>
</li>
<li>
<p>https://www.securecoding.cert.org/confluence/display/java/OBJ05-J.+Defensively+copy+private+mutable+class+members+before+returning+their+references</p>
</li>
</ul>
</div>
</div>
</div>
</div>