<div class="paragraph">
<p>In Python function parameters can have default values. These default values are expressions which are executed when the function is defined, i.e. only once. The same default value will be used every time the function is called, thus modifying it will have an effect on every subsequent call. This can create some very confusing bugs.</p>
</div>
<div class="paragraph">
<p>It is also a bad idea to store mutable default value in another object (ex: as an attribute). Multiple instances will then share the same value and modifying one objet will modify all of them.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a default value is either modified in the function or assigned to anything else than a variable and it has one of the following types:</p>
<div class="ulist">
<ul>
<li>
<p>builtins: set, dict, list.</p>
</li>
<li>
<p><a href="https://docs.python.org/3/library/collections.html">collections</a> module: deque, UserList, ChainMap, Counter, OrderedDict, defaultdict, UserDict.</p>
</li>
</ul>
</div>
</li>
<li>
<p>or when an attribute of a default value is assigned.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following example, the parameter "param" has <code>list()</code> as a default value. This list is created only once and then reused in every call. Thus when it appends <code>'a'</code> to this list, the next call will have <code>['a']</code> as a default value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>def myfunction(param=list()):  # Noncompliant.
    param.append('a')  # modification of the default value.
    return param

print(myfunction()) # returns ['a']
print(myfunction()) # returns ['a', 'a']
print(myfunction()) # returns ['a', 'a', 'a']</pre>
</div>
</div>
<div class="paragraph">
<p>In the following example the same list is used for multiple instances of MyClass.param.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class MyClass:
    def __init__(self, param=list()):  # Noncompliant.
        self.param = param  # The same list is used for every instance of MyClass

    def process(self, value):
        self.param.append(value)  # modifying the same list

a1, a2 = (MyClass(), MyClass())
a1.process("value")
print(a1.param)  # ['value']
print(a2.param)  # ['value']</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>def myfunction(param=None):
    if param is None:
        param = list()
    param.append('a')
    return param

print(myfunction()) # returns ['a']
print(myfunction()) # returns ['a']
print(myfunction()) # returns ['a']</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>class MyClass:
    def __init__(self, param=None):
        if param is None:
            self.param = list()
        else:
            self.param = param

    def process(self, value):
        self.param.append(value)

a1, a2 = (MyClass(), MyClass())
a1.process("value")
print(a1.param)  # ['value']
print(a2.param)  # []</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some very rare cases modifying a default value is ok. For example, default values can be used as a cache.</p>
</div>
<div class="paragraph">
<p>No issue will be raised when the parameter&#8217;s name contains "cache" or "memo" (as in memoization).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.python-guide.org/writing/gotchas/#mutable-default-arguments">The Hitchhiker&#8217;s Guide to Python - Common Gotchas</a></p>
</li>
<li>
<p><a href="https://docs.python.org/3/reference/compound_stmts.html#function-definitions">Python documentation - Function definitions</a></p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this default value to "None" and initialize this parameter inside the function/method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: the default value</p>
</li>
<li>
<p>Secondaries:</p>
<div class="ulist">
<ul>
<li>
<p>code modifying the parameter:
message: 'The parameter is modified.'</p>
</li>
<li>
<p>code assigning the parameter to something else
message: 'The parameter is stored in another object.'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>