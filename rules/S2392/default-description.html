<div class="paragraph">
<p>Variables that are declared inside a block but used outside of it (which is possible with a <code>var</code>-style declaration) should be declared outside the block.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>function doSomething(a, b) {
  if (a &gt; b) {
    var x = a - b;  // Noncompliant
  }

  if (a &gt; 4) {
    console.log(x);
  }

  for (var i = 0; i &lt; m; i++) { // Noncompliant, both loops use same variable
  }

  for (var i = 0; i &lt; n; i++) {
  }

  return a + b;
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>function doSomething(a, b) {
  var x;

  if (a &gt; b) {
    x = a - b;
  }

  if (a &gt; 4) {
    console.log(x);
  }

  for (let i = 0; i &lt; m; i++) {
  }

  for (let i = 0; i &lt; n; i++) {
  }


  return a + b;
}</pre>
</div>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Consider moving declaration of 'XXX' as it is referenced outside current binding context.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>primary: the variable definition</p>
</li>
<li>
<p>secondary: every reference to the variable outside of the current binding context.</p>
<div class="ulist">
<ul>
<li>
<p>message: 'Outside reference.'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_26_jan_2016_105124_elena_vilchik_wrote">on 26 Jan 2016, 10:51:24 Elena Vilchik wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] WDYT if we change this rule to not function scope but to java-like scopes (function+loops+if)?</p>
</div>
<div class="paragraph">
<p>Following to this convention will ease transition to ES2015 variables declarations (let and const)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_feb_2016_092403_elena_vilchik_wrote">on 17 Feb 2016, 09:24:03 Elena Vilchik wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I removed part about functions as it probably will produce FP. See</p>
</div>
<div class="listingblock">
<div class="content">
<pre>var y;   // OK

function foo(p) {
  if (y) {
    bar(y);
  }
  y = p;
}

for (var j = 1; j &lt; 10; j++) {
  foo(j)
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_feb_2016_094946_elena_vilchik_wrote">on 18 Feb 2016, 09:49:46 Elena Vilchik wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Looks like after removing this "function" thing this rule has not  much in common with RSPEC-1899. May be we should make it as separate RSPEC, WDYT? (cc [~pierre-yves.nicolas])</p>
</div>
</div>
</div>
</div>