<div class="paragraph">
<p>Applications that execute code dynamically should neutralize any externally-provided values used to construct the code. Failure to do so could allow an attacker to execute arbitrary code. This could enable a wide range of serious attacks like accessing/modifying sensitive information or gain full system access.</p>
</div>
<div class="paragraph">
<p>The mitigation strategy should be based on whitelisting of allowed values or casting to safe types.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>eval</code> and other functions that dynamically execute code should not be used in combination with user-input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let input = req.query.input;
eval(input); // Noncompliant
(Function(input))(); // Noncompliant
(new Function(input))(); // Noncompliant</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>const vm = require("vm");

let input = req.query.input;
vm.runInThisContext(input);  // Noncompliant
const context = {};
vm.createContext(context);
vm.runInContext(input, context); // Noncompliant
vm.runInNewContext(input, context); // Noncompliant
vm.compileFunction(input)(); // Noncompliant
(new vm.Script(input)).runInThisContext(); // Noncompliant</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>var Module = require('module');

let name = req.query.name;
let input = req.query.input;
var mod = new Module(name, module.parent);
mod._compile(input, name); // Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p>In a MongoDB context, <a href="https://docs.mongodb.com/manual/faq/fundamentals/#how-does-mongodb-address-sql-or-query-injection">arbitrary Javascript code</a> can be executed with the <code>$where</code> operator for instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let username = req.query.username;
query = { $where: `this.username == '${username}'` } // Noncompliant
User.find(query, function (err, users) {
  if (err) {
    // Handle errors
  } else {
    res.render('userlookup', { title: 'User Lookup', users: users });
  }
});</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If <code>eval</code> is used to parse a JSON string this should be done instead with <code>JSON.parse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let obj = JSON.parse(req.query.input); // Compliant</pre>
</div>
</div>
<div class="paragraph">
<p>In a MongoDB context, don&#8217;t use <code>$where</code> operator or validate the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let username = req.query.username;
query = { username: username } // Compliant
User.find(query, function (err, users) {
  if (err) {
    // Handle errors
  } else {
    res.render('userlookup', { title: 'User Lookup', users: users });
  }
});</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/20.html">MITRE, CWE-20</a> - Improper Input Validation</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/95.html">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')</p>
</li>
<li>
<p><a href="https://www.sans.org/top25-software-errors/#cat2">SANS Top 25</a> - Risky Resource Management</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to not dynamically execute code influenced user-controlled data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>"[varname]" is tainted (assignments and parameters)</p>
</div>
<div class="paragraph">
<p>this argument is tainted (method invocations)</p>
</div>
<div class="paragraph">
<p>the returned value is tainted (returns &amp; method invocations results)</p>
</div>
</div>
</div>
</div>