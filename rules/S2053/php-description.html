<div class="paragraph">
<p>In cryptography, a "salt" is an extra piece of data which is included when hashing a password. This makes <code>rainbow-table attacks</code> more difficult. Using a cryptographic hash function without an unpredictable salt increases the likelihood that an attacker could successfully find the hash value in databases of precomputed hashes (called <code>rainbow-tables</code>).</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when a hashing function which has been specifically designed for hashing passwords, such as <code>PBKDF2</code>, is used with a non-random, reused or too short salt value. It does not raise an issue on base hashing algorithms such as <code>sha1</code> or <code>md5</code> as they should not be used to hash passwords.</p>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use hashing functions generating their own secure salt or generate a secure random value of at least 16 bytes.</p>
</li>
<li>
<p>The salt should be unique by user password.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>function createMyAccount() {
  $email = $_GET['email'];
  $name = $_GET['name'];
  $password = $_GET['password'];

  $hash = hash_pbkdf2('sha256', $password, $email, 100000); // Noncompliant; salt (3rd argument) is predictable because initialized with the provided $email

  $hash = hash_pbkdf2('sha256', $password, '', 100000); // Noncompliant; salt is empty

  $hash = hash_pbkdf2('sha256', $password, 'D8VxSmTZt2E2YV454mkqAY5e', 100000); // Noncompliant; salt is hardcoded

  $hash = crypt($password); // Noncompliant; salt is not provided; fails in PHP 8
  $hash = crypt($password, ""); // Noncompliant; salt is hardcoded; fails in PHP 8

  $options = [
    'cost' =&gt; 11,
    'salt' =&gt; mcrypt_create_iv(22, MCRYPT_DEV_URANDOM), // Noncompliant ; use salt generated by default
  ];
  echo password_hash("rasmuslerdorf", PASSWORD_BCRYPT, $options);
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>$salt = openssl_random_pseudo_bytes(16);
$hash = hash_pbkdf2("sha256", $password, $salt, $iterations, 20);</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/759.html">MITRE, CWE-759</a> - Use of a One-Way Hash without a Salt</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/760.html">MITRE, CWE-760</a> - Use of a One-Way Hash with a Predictable Salt</p>
</li>
<li>
<p><a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Add an unpredictable salt value to this hash.</p>
</li>
<li>
<p>Make this salt unpredictable.</p>
</li>
<li>
<p>Make this salt at least 16 bytes.</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_9_jul_2018_165436_alexandre_gigleux_wrote">on 9 Jul 2018, 16:54:36 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>Reference: http://php.net/manual/en/function.hash-pbkdf2.php</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The salt to use for the derivation. This value should be generated randomly.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_on_25_jul_2018_115446_andrei_epure_wrote">on 25 Jul 2018, 11:54:46 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>\[~tibor.blenessy] , [~alexandre.gigleux] : should we also treat <a href="http://php.net/manual/en/function.crypt.php">crypt</a> and <a href="http://php.net/manual/en/function.password-hash.php">password_hash</a> , which both receive salt arguments and seem to be the <a href="http://php.net/manual/en/faq.passwords.php">php-recommended</a> hash functions?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_25_jul_2018_193730_tibor_blenessy_wrote">on 25 Jul 2018, 19:37:30 Tibor Blenessy wrote:</h3>
<div class="paragraph">
<p>I covered these additional functions</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_jul_2018_102528_andrei_epure_wrote">on 26 Jul 2018, 10:25:28 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>It would be nice to add a compliant example</p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s4790">relates to: S4790</h3>

</div>
<div class="sect2">
<h3 id="_on_20_jul_2015_074916_ann_campbell_wrote">on 20 Jul 2015, 07:49:16 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Tagged java-top by Ann</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_nov_2020_151748_alexandre_gigleux_wrote">on 2 Nov 2020, 15:17:48 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~pierre-loup.tristant] The Juliet C# Test Suite contains 2 set of test cases related to this rule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CWE759_Unsalted_One_Way_Hash</p>
</li>
<li>
<p>CWE760_Predictable_Salt_One_Way_Hash</p>
</li>
</ul>
</div>
</div>
</div>
</div>