<div class="paragraph">
<p>When working with <code>float</code> or <code>double</code> primitive types, it may be required to deal with <code>NaN</code> (Not a Number) values. When tested against itself, <code>NaN</code> will always answer <code>false</code> as long as the primitive wrapper type is not used. When the wrapper is used, it will always be <code>true</code>. This property is illustrated in the code snipped below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>double d = getValue();
if (d == d) { // false for primitive 'double' when NaN, and true for any non-NaN values
  doSomething();
}

Double bigD = getValue();
if (bigD == bigD) { // always true for wrapper type 'Double' when NaN, AND with any other Double value
  doSomething();
}</pre>
</div>
</div>
<div class="paragraph">
<p>In order to remove any ambiguity, this rule raises an issue every time an equality test is used with <code>double</code>, <code>Double</code>, <code>float</code> or <code>Float</code>, when both sides of the test are the same variable. The <code>isNaN(...)</code> methods from <code>Double</code> and <code>Float</code> should be preferred.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>double x = getValue();
if (x == x) { // Noncompliant
  doSomething();
}
if (x == Double.NaN) { // Noncompliant
  doSomething();
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>double x = getValue();
if (Double.isNaN(x)) { // compliant
  doSomething();
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/wzdGBQ">CERT, NUM07-J.</a> - Do not attempt comparisons with NaN</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Replace this equality test with "Double/Float.isNaN(&#8230;&#8203;)".</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>equality</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_31_jan_2018_165317_ann_campbell_wrote">on 31 Jan 2018, 16:53:17 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski] this rule duplicates RSPEC-2688. Make it a subtask?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_jan_2018_165746_michael_gumowski_wrote">on 31 Jan 2018, 16:57:46 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>Arf, I missed that when I searched for <code>NaN</code> in RSPEC&#8230;&#8203; Thanks for noticing it [~ann.campbell.2]. It&#8217;s indeed a duplicate, but to me RSPEC-2688 is not that good as an explanation. What do you mean by making it a subtask? replacing the existing subtask?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_jan_2018_172305_ann_campbell_wrote">on 31 Jan 2018, 17:23:05 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski] the main task talks about using a <code>NaN</code>-testing function, which is what this rule also talks about. So yes, replacing the subtask makes sense to me, particularly if you don&#8217;t like the suggested remediation in the existing subtask.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_feb_2018_084217_michael_gumowski_wrote">on 1 Feb 2018, 08:42:17 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Ok, so let&#8217;s make it a subtask. Can you take charge of it? I&#8217;m not sure what to do with the previous one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_feb_2018_163448_ann_campbell_wrote">on 1 Feb 2018, 16:34:48 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Done [~michael.gumowski]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_feb_2018_080830_michael_gumowski_wrote">on 2 Feb 2018, 08:08:30 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>Thx!</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_19_may_2015_140951_linda_martin_wrote">on 19 May 2015, 14:09:51 Linda Martin wrote:</h3>
<div class="paragraph">
<p>Reviewed.</p>
</div>
</div>
</div>
</div>