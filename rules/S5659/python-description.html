<div class="paragraph">
<p>If a JSON Web Token (JWT) is not signed with a strong cipher algorithm (or not signed at all) an attacker can forge it and impersonate user identities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t use <code>none</code> algorithm to sign or verify the validity of a token.</p>
</li>
<li>
<p>Don&#8217;t use a token without verifying its signature before.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://github.com/jpadilla/pyjwt">pyjwt</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jwt.decode(token, verify = False)  # Noncompliant
jwt.decode(token, key, options={"verify_signature": False})  # Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://github.com/davedoesdev/python-jwt">python_jwt</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jwt.process_jwt(token)  # Noncompliant</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://github.com/jpadilla/pyjwt">pyjwt</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jwt.decode(token, key, algo)</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://github.com/davedoesdev/python-jwt">python_jwt</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jwt.process_jwt(token)  #  Compliant because followed by verify_jwt()
jwt.verify_jwt(token, key, algo)</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/347.html">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use only strong cipher algorithms when [signing|verifying the signature of] this JWT.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_22_feb_2021_111711_pierre_yves_nicolas_wrote">on 22 Feb 2021, 11:17:11 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>The first code example of the current description of the RSPEC links to <a href="https://github.com/GehirnInc/python-jwt" class="bare">https://github.com/GehirnInc/python-jwt</a> but this is another JWT implementation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>There are multiple JWT implementations in Python with very similar names and they sometimes use the same namespace...</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>PyJWT: <a href="https://github.com/jpadilla/pyjwt" class="bare">https://github.com/jpadilla/pyjwt</a>
<a href="https://pyjwt.readthedocs.io/en/latest/index.html">doc</a></p>
<div class="literalblock">
<div class="content">
<pre>This is the one which matches the first code example of the current description.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>https://pyjwt.readthedocs.io/en/latest/changelog.html#v2-0-0[Starting with version 2.0], the verify param of the decode function was dropped and replaced with</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>jwt.decode(encoded, key, options={"verify_signature": False}){code}

 * [https://github.com/davedoesdev/python-jwt]
 This is the one which has a process_jwt function.
{quote}From version 2.0.1 the namespace has changed from jwt to python_jwt, in order to avoid conflict with PyJWT.
{quote}

 * [https://github.com/GehirnInc/python-jwt]
 This implementation is wrongly linked in the current description of the ticket.
 It's actually not covered by the current description of the RSPEC.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_feb_2021_140626_pierre_yves_nicolas_wrote">on 22 Feb 2021, 14:06:26 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>\[~hendrik.buchwald] Should we raise an issue on the following code?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>try:
    jwt.decode(token, key, algo)
except:
    raise Exception("Invalid token")</pre>
</div>
</div>
<div class="paragraph">
<p>Real world cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>https://github.com/Bounties-Network/BountiesAPI/blob/7931957e56c9fcef574dd3a00ec5ab9a787a365c/bounties_api/user/middleware.py#L20</p>
</li>
<li>
<p>https://github.com/DragonComputer/Dragonfire/blob/dd21f8e88d9b6390bd229ff73f89a8c3c137b89c/dragonfire/api.py#L47</p>
</li>
<li>
<p>https://github.com/JeffVandrewJr/patron/blob/b2545066c8e57e398f4896eb9b25fb4e970e0f06/app/models.py#L125</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_feb_2021_173135_pierre_yves_nicolas_wrote">on 22 Feb 2021, 17:31:35 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>\[~hendrik.buchwald] Shouldn&#8217;t we drop the last part of the rule title ("with strong cipher algorithms") since we don&#8217;t check the algorithm?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_feb_2021_104209_hendrik_buchwald_wrote">on 24 Feb 2021, 10:42:09 Hendrik Buchwald wrote:</h3>
<div class="paragraph">
<p>\[~pierre-yves.nicolas] thanks, good catch! Luckily I only confused the links, the first one was supposed to be PyJWT (as that one is used much more often). I will change the name of the rule.</p>
</div>
<div class="paragraph">
<p>That are nice examples for the exceptions. While they are of course secure I think it might be fine to still raise this issue since there is no reason to not check for the right type of exception (e.g. <code>jwt.InvalidSignatureError</code>). The intention of this specification is though to detect cases where the invalid signature exception is caught accidentally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_feb_2021_130931_hendrik_buchwald_wrote">on 24 Feb 2021, 13:09:31 Hendrik Buchwald wrote:</h3>
<div class="paragraph">
<p>I have removed the exception case for now.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_sep_2020_144432_alexandre_gigleux_wrote">on 18 Sep 2020, 14:44:32 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~eric.therond] The same should be implemented for Python:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Noncompliant Code: https://github.com/we45/Vulnerable-Flask-App/blob/752ee16087c0bfb79073f68802d907569a1f0df7/app/app.py#L97</p>
</li>
<li>
<p>Compliant Code: https://github.com/we45/Vulnerable-Flask-App/blob/752ee16087c0bfb79073f68802d907569a1f0df7/app/app.py#L86</p>
</li>
</ul>
</div>
</div>
</div>
</div>