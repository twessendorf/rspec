<div class="paragraph">
<p>If a JSON Web Token (JWT) is not signed with a strong cipher algorithm (or not signed at all) an attacker can forge it and impersonate user identities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t use <code>none</code> algorithm to sign or verify the validity of a token.</p>
</li>
<li>
<p>Don&#8217;t use a token without verifying its signature before.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/jwt-dotnet/jwt">jwt-dotnet</a> library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>var decodedtoken1 = decoder.Decode(token, secret, verify: false); // Noncompliant: signature should be verified

var decodedtoken2 = new JwtBuilder()
   .WithSecret(secret)
   .Decode(forgedtoken1); // Noncompliant: signature should be verified</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/jwt-dotnet/jwt">jwt-dotnet</a> library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>var decodedtoken1 = decoder.Decode(forgedtoken1, secret, verify: true); // Compliant

var decodedtoken2 = new JwtBuilder()
   .WithSecret(secret)
   .MustVerifySignature()
   .Decode(token); // Compliant</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/347.html">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use only strong cipher algorithms when [signing|verifying the signature of] this JWT.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_4_mar_2020_163113_pavel_mikula_wrote">on 4 Mar 2020, 16:31:13 Pavel Mikula wrote:</h3>
<div class="paragraph">
<p>Hi [~eric.therond],</p>
</div>
<div class="paragraph">
<p>I&#8217;m about to implement this one. Message and description mentions encoding phase as well, but I haven&#8217;t found encoding example any where. And JwtEncoder does not accept null instead of encoding algorithm.</p>
</div>
<div class="paragraph">
<p>So the encoding is save and we should care only about decoding in this rule?</p>
</div>
<div class="paragraph">
<p>Should we keep same message for C# as well? It seems useful to use more precise message here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_mar_2020_171748_eric_therond_wrote">on 4 Mar 2020, 17:17:48 Eric Therond wrote:</h3>
<div class="paragraph">
<p>Hi [~pavel.mikula]</p>
</div>
<div class="paragraph">
<p>I didn&#8217;t see either a way to not sign a JWT (or with "none" algorithm) with this library.</p>
</div>
<div class="paragraph">
<p>For the moment, we only need to worry about decoding/signature verification in this rule for C# but I suppose it exists other libraries that could be unsafe for the signing part.</p>
</div>
<div class="paragraph">
<p>It&#8217;s better to not have messages which depend of the language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to not confuse users when they switch from one language to another</p>
</li>
<li>
<p>it&#8217;s easier to maintain on our side</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maybe we could have a "dynamic" message:</p>
</div>
<div class="paragraph">
<p>" Use only strong cipher algorithms when xxx this JWT. "</p>
</div>
<div class="paragraph">
<p>And replace "xxx" with  "signing" or "verifying the signature of" depending on whether the rule finds a "signing vulnerable method" or a "verifying vulnerable method"</p>
</div>
<div class="paragraph">
<p>But I don&#8217;t know how to specify this in JIRA</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_mar_2020_083827_pavel_mikula_wrote">on 5 Mar 2020, 08:38:27 Pavel Mikula wrote:</h3>
<div class="paragraph">
<p>Hi [~eric.therond],</p>
</div>
<div class="paragraph">
<p>Thanks for clarification.</p>
</div>
<div class="paragraph">
<p>Looking at <a href="https://jira.sonarsource.com/browse/RSPEC-3240">RSPEC-3240</a> and <a href="https://jira.sonarsource.com/browse/RSPEC-100">RSPEC-100</a> it seems that this is the way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Use only strong cipher algorithms when [signing|verifying the signature of] this JWT.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_mar_2020_084511_eric_therond_wrote">on 5 Mar 2020, 08:45:11 Eric Therond wrote:</h3>
<div class="paragraph">
<p>thanks [~pavel.mikula] for the tip, I have updated the RSPEC.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_sep_2020_144432_alexandre_gigleux_wrote">on 18 Sep 2020, 14:44:32 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~eric.therond] The same should be implemented for Python:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Noncompliant Code: https://github.com/we45/Vulnerable-Flask-App/blob/752ee16087c0bfb79073f68802d907569a1f0df7/app/app.py#L97</p>
</li>
<li>
<p>Compliant Code: https://github.com/we45/Vulnerable-Flask-App/blob/752ee16087c0bfb79073f68802d907569a1f0df7/app/app.py#L86</p>
</li>
</ul>
</div>
</div>
</div>
</div>