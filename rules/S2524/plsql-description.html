<div class="paragraph">
<p>Subqueries are nested when they appear in the <code>WHERE</code> clause of the parent statement. When an Oracle database evaluates a statement with a nested subquery, it must evaluate the subquery portion multiple times and may overlook some efficient access paths or joins.</p>
</div>
<div class="paragraph">
<p>Subquery unnesting unnests and merges the body of the subquery into the body of the statement that contains it, allowing the optimizer to consider the queries together when evaluating access paths and joins. The optimizer can unnest most subqueries, with some exceptions. Those exceptions include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hierarchical subqueries</p>
</li>
<li>
<p>subqueries that contain a <code>ROWNUM</code> pseudocolumn</p>
</li>
<li>
<p>subqueries that contain one of the set operators</p>
</li>
<li>
<p>subqueries that contain a nested aggregate function</p>
</li>
<li>
<p>subqueries that contain a correlated reference to a query block that is not the immediate outer query block of the subquery.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assuming no restrictions exist, the optimizer automatically unnests some (but not all) of the following nested subqueries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uncorrelated <code>IN</code> subqueries</p>
</li>
<li>
<p><code>IN</code> and <code>EXISTS</code> correlated subqueries, as long as they do not contain aggregate functions or a <code>GROUP BY</code> clause</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable extended subquery unnesting by instructing the optimizer to unnest additional types of subqueries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can unnest an uncorrelated <code>NOT IN</code> subqueries by specifying the <code>HASH_AJ</code> or <code>MERGE_AJ</code> hint in the subquery.</p>
</li>
<li>
<p>You can unnest other subqueries by specifying the <code>UNNEST</code> hint in the subquery.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because these optimizations are dependant on the version of Oracle used, it is best to avoid using nested subqueries in the first place when possible.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>BEGIN
  SELECT col1
  BULK COLLECT INTO result
  FROM table1
  WHERE col2 IN (SELECT col3 FROM table2); -- Noncompliant
END;
/</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>BEGIN
  SELECT col1                              -- Compliant
  BULK COLLECT INTO result
  FROM table1
  JOIN table2 ON col2 = col3;
END;
/</pre>
</div>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Refactor this SQL to removed the nested subquery.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>key = excludeAntiJoins</p>
</li>
<li>
<p>description: Whether antijoins ("NOT IN", "NOT EXISTS") should be ignored</p>
</li>
<li>
<p>type: boolean</p>
</li>
<li>
<p>default: false</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: The "WHERE" keyword</p>
</li>
<li>
<p>Secondary: every subquery
message: 'Nested subquery.'</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s1282">relates to: S1282</h3>

</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_161808_freddy_mallet_wrote">on 3 Feb 2015, 16:18:08 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>@Ann, I&#8217;ve the feeling that this rule duplicates RSPEC-1282 ?  Moreover I would use the tag "sql"</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_183220_ann_campbell_wrote">on 3 Feb 2015, 18:32:20 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] I&#8217;ve linked them, but I&#8217;m going to keep them separate; different SQALE, plus a lot of Oracle-specific data in this version that wouldn&#8217;t necessarily apply to COBOL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2015_094705_freddy_mallet_wrote">on 4 Feb 2015, 09:47:05 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Ok [~ann.campbell.2]</p>
</div>
</div>
</div>
</div>