<div class="paragraph">
<p>It is not good enough to test if an exception is raised, without checking which exception it is. Such tests will not be able to differentiate the expected exception from an unexpected one. They should instead validate the exception message and/or type.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When an asynchronous Mocha test calls the <code>done()</code> callback, without parameters, in a <code>catch</code> block and there is no reference to the caught exception in this block. Either the error should be passed to <code>done()</code> or the exception should be checked further.</p>
</li>
<li>
<p>When Chai assertions are used to test if a function throws any exception, or an exception of type <code>Error</code> without checking the message.</p>
</li>
<li>
<p>When Chai assertions are used to test if a function does not throw an exception of type <code>Error</code> without checking the message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rule doesn&#8217;t raise an issue when assertion is negated using <code>not</code>, it such case the exception doesn&#8217;t need to be specific.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>const expect = require("chai").expect;
const fs = require("fs");

describe("exceptions are not tested properly", function() {
    const funcThrows = function () { throw new TypeError('What is this type?'); };
    const funcNoThrow = function () { /*noop*/ };

    it("forgot to pass the error to 'done()'", function(done) {
        fs.readFile("/etc/zshrc", 'utf8', function(err, data) {
            try {
                expect(data).to.match(/some expected string/);
            } catch (e) {  // Noncompliant
                // Either the exception should be passed to done(e), or the exception should be tested further.
                done();
            }
        });
    });

    it("does not 'expect' a specific exception", function() {
        expect(funcThrows).to.throw();  // Noncompliant
        // Error is not precise enough
        expect(funcThrows).to.throw(Error);  // Noncompliant
    });
});</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>const expect = require("chai").expect;
const { AssertionError } = require('chai');
const fs = require("fs");

describe("exceptions are tested properly", function() {
    const funcThrows = function () { throw new TypeError('What is this type?'); };
    const funcNoThrow = function () { /*noop*/ };

    it("forgot to pass the error to 'done()'", function(done) {
        fs.readFile("/etc/zshrc", 'utf8', function(err, data) {
            try {
                expect(data).to.match(/some expected string/);
            } catch (e) {
                expect(e).to.be.an.instanceof(AssertionError);
                done();
            }
        });
    });

    it("does not 'expect' a specific exception", function() {
        expect(funcThrows).to.throw(TypeError);
        expect(funcNoThrow).to.not.throw(Error, /My error message/);
    });
});</pre>
</div>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>When an assertion function is used:
message: 'Test precisely which exception is [not] thrown.'</p>
</li>
<li>
<p>When <code>try...catch...done</code> is used:
message: 'Test if the right exception is caught, or pass it to "done()" below.'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>When an assertion function is used:</p>
<div class="ulist">
<ul>
<li>
<p>location: the assertion function</p>
</li>
</ul>
</div>
</li>
<li>
<p>When <code>try...catch...done</code> is used:</p>
<div class="ulist">
<ul>
<li>
<p>Primary location: the <code>catch (e)</code> statement</p>
</li>
<li>
<p>Secondary location: the call to <code>done()</code>
message: 'done()" is called without checking the exception.'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>