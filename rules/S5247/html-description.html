<div class="paragraph">
<p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>,  <code>Django</code>,  <code>Smarty</code>,  <code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
</div>
<div class="paragraph">
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy  (which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not escaped and thus an attack as below is possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)</pre>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Templates are used to render web content and</p>
<div class="ulist">
<ul>
<li>
<p>dynamic variables in templates come from untrusted locations or are user-controlled inputs</p>
</li>
<li>
<p>there is no local mechanism in place to sanitize or validate the inputs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right one.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>&lt;!-- Laravel Blade templates --&gt;
&lt;p&gt;{!! $variable !!}&lt;/p&gt;&lt;!-- Sensitive --&gt;

&lt;!-- Twig templates --&gt;
{% autoescape false %}&lt;!-- Sensitive --&gt;
{{ article.body|raw }}&lt;!-- Sensitive --&gt;

&lt;!-- Smarty templates --&gt;
&lt;p&gt;{$var nofilter}&lt;/p&gt;&lt;!-- Sensitive --&gt;

&lt;!-- Django templates --&gt;
&lt;p&gt;{{ variable|safe }}&lt;/p&gt;&lt;!-- Sensitive --&gt;
{% autoescape off %}&lt;!-- Sensitive --&gt;

&lt;!-- Jinja2 templates --&gt;
&lt;p&gt;{{ variable|safe }}&lt;/p&gt;&lt;!-- Sensitive --&gt;
{% autoescape false %}&lt;!-- Sensitive --&gt;

&lt;!-- Apache Freemarker templates --&gt;
&lt;#ftl output_format="HTML" auto_esc=false&gt;&lt;!-- Sensitive --&gt;
&lt;p&gt;${message?no_esc}&lt;/p&gt;&lt;!-- Sensitive --&gt;
&lt;#noautoesc&gt;&lt;!-- Sensitive --&gt;
&lt;#noescape&gt;&lt;!-- Sensitive --&gt;

&lt;!-- Jelly templates --&gt;
&lt;?jelly escape-by-default='false'?&gt;&lt;!-- Sensitive --&gt;
&lt;j:out value="${t.name}"/&gt;&lt;!-- Sensitive --&gt;

&lt;!-- Java Server Faces (JSF) --&gt;
&lt;h:outputText value="#{user.name}" escape="false" /&gt;&lt;!-- Sensitive --&gt;
&lt;f:selectItem itemLabel="#{user.status3}" escapeItem="false" /&gt;&lt;!-- Sensitive --&gt;
&lt;f:selectItems itemLabel="#{user.status3}" itemLabelEscaped="false" /&gt;&lt;!-- Sensitive --&gt;

&lt;!-- JavaServer Pages (JSP) --&gt;
&lt;p&gt;&lt;c:out value="${message}" escapeXml="false" /&gt;&lt;/p&gt;&lt;!-- Sensitive --&gt;

&lt;!-- Java Spring --&gt;
&lt;spring:htmlEscape defaultHtmlEscape="false"&gt;&lt;!-- Sensitive --&gt;
&lt;spring:escapeBody htmlEscape="false"&gt;&lt;!-- Sensitive --&gt;
&lt;form:input path="lastName" htmlEscape="false" /&gt;&lt;!-- Sensitive --&gt;

&lt;!-- Thymeleaf templates --&gt;
&lt;p th:utext="${message}" /&gt;&lt;!-- Sensitive --&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection</p>
</li>
<li>
<p><a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat Sheet</a> - XSS Prevention Cheat Sheet</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A7-Cross-Site_Scripting_(XSS)">OWASP Top 10 2017 Category A7</a> - Cross-Site Scripting (XSS)</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/79.html">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure disabling auto-escaping feature is safe here.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_14_may_2019_214957_lars_svensson_wrote">on 14 May 2019, 21:49:57 Lars Svensson wrote:</h3>
<div class="paragraph">
<p>References:</p>
</div>
<div class="paragraph">
<p>Blade</p>
</div>
<div class="paragraph">
<p><a href="https://laravel.com/docs/5.8/blade" class="bare">https://laravel.com/docs/5.8/blade</a></p>
</div>
<div class="paragraph">
<p>Twig</p>
</div>
<div class="paragraph">
<p><a href="https://twig.symfony.com/doc/2.x/tags/autoescape.html" class="bare">https://twig.symfony.com/doc/2.x/tags/autoescape.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://twig.symfony.com/doc/2.x/filters/escape.html" class="bare">https://twig.symfony.com/doc/2.x/filters/escape.html</a></p>
</div>
<div class="paragraph">
<p>Smarty</p>
</div>
<div class="paragraph">
<p><a href="https://www.smarty.net/docs/en/variable.escape.html.tpl" class="bare">https://www.smarty.net/docs/en/variable.escape.html.tpl</a></p>
</div>
<div class="paragraph">
<p>Freemarker</p>
</div>
<div class="paragraph">
<p><a href="https://freemarker.apache.org/docs/dgui_misc_autoescaping.html#dgui_misc_autoescaping_disableautoesc" class="bare">https://freemarker.apache.org/docs/dgui_misc_autoescaping.html#dgui_misc_autoescaping_disableautoesc</a></p>
</div>
<div class="paragraph">
<p><a href="https://freemarker.apache.org/docs/ref_directive_escape.html" class="bare">https://freemarker.apache.org/docs/ref_directive_escape.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://freemarker.apache.org/docs/ref_directive_ftl.html" class="bare">https://freemarker.apache.org/docs/ref_directive_ftl.html</a></p>
</div>
<div class="paragraph">
<p>Django</p>
</div>
<div class="paragraph">
<p><a href="https://docs.djangoproject.com/en/dev/ref/templates/builtins/#autoescape" class="bare">https://docs.djangoproject.com/en/dev/ref/templates/builtins/#autoescape</a></p>
</div>
<div class="paragraph">
<p>Jelly</p>
</div>
<div class="paragraph">
<p><a href="https://wiki.jenkins.io/display/JENKINS/Jelly+and+XSS+prevention" class="bare">https://wiki.jenkins.io/display/JENKINS/Jelly+and+XSS+prevention</a></p>
</div>
<div class="paragraph">
<p>JSF</p>
</div>
<div class="paragraph">
<p><a href="https://docs.oracle.com/javaee/7/javaserver-faces-2-2/vdldocs-facelets/h/outputText.html" class="bare">https://docs.oracle.com/javaee/7/javaserver-faces-2-2/vdldocs-facelets/h/outputText.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.oracle.com/javaee/6/javaserverfaces/2.1/docs/vdldocs/facelets/f/selectItem.html" class="bare">https://docs.oracle.com/javaee/6/javaserverfaces/2.1/docs/vdldocs/facelets/f/selectItem.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.oracle.com/javaee/6/javaserverfaces/2.1/docs/vdldocs/facelets/f/selectItems.html" class="bare">https://docs.oracle.com/javaee/6/javaserverfaces/2.1/docs/vdldocs/facelets/f/selectItems.html</a></p>
</div>
<div class="paragraph">
<p>Spring</p>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring/docs/1.2.x/taglib/tag/HtmlEscapeTag.html" class="bare">https://docs.spring.io/spring/docs/1.2.x/taglib/tag/HtmlEscapeTag.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring/docs/1.1.5/taglib/tag/EscapeBodyTag.html" class="bare">https://docs.spring.io/spring/docs/1.1.5/taglib/tag/EscapeBodyTag.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_14_aug_2019_172419_pierre_loup_tristant_wrote">on 14 Aug 2019, 17:24:19 Pierre-Loup Tristant wrote:</h3>
<div class="paragraph">
<p>Jinja2</p>
</div>
<div class="paragraph">
<p><a href="https://jinja.palletsprojects.com/en/2.9.x/templates/#autoescape-overrides" class="bare">https://jinja.palletsprojects.com/en/2.9.x/templates/#autoescape-overrides</a></p>
</div>
<div class="paragraph">
<p><a href="https://jinja.palletsprojects.com/en/2.9.x/templates/#safe" class="bare">https://jinja.palletsprojects.com/en/2.9.x/templates/#safe</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecates_s5439">deprecates: S5439</h3>

</div>
</div>
</div>