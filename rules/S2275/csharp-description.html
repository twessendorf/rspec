<div class="paragraph">
<p>Because composite format strings are interpreted at runtime, rather than validated by the compiler, they can contain errors that lead to unexpected behaviors or runtime errors. This rule statically validates the good behavior of composite formats when calling the methods of <code>String.Format</code>, <code>StringBuilder.AppendFormat</code>, <code>Console.Write</code>, <code>Console.WriteLine</code>, <code>TextWriter.Write</code>, <code>TextWriter.WriteLine</code>, <code>Debug.WriteLine(String, Object[])</code>, <code>Trace.TraceError(String, Object[])</code>, <code>Trace.TraceInformation(String, Object[])</code>, <code>Trace.TraceWarning(String, Object[])</code> and <code>TraceSource.TraceInformation(String, Object[])</code>.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>s = string.Format("[0}", arg0);
s = string.Format("{{0}", arg0);
s = string.Format("{0}}", arg0);
s = string.Format("{-1}", arg0);
s = string.Format("{0} {1}", arg0);</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>s = string.Format("{0}", 42); // Compliant
s = string.Format("{0,10}", 42); // Compliant
s = string.Format("{0,-10}", 42); // Compliant
s = string.Format("{0:0000}", 42); // Compliant
s = string.Format("{2}-{0}-{1}", 1, 2, 3); // Compliant
s = string.Format("no format"); // Compliant</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">Exceptions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>No issue is raised if the format string is not a <code>const</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>var pattern = "{0} {1} {2}";
var res = string.Format(pattern, 1, 2); // Compliant, not const string are not recognized</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>No issue is raised if the argument is not an inline creation array.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>var array = new int[] {};
var res = string.Format("{0} {1}", array); // Compliant we don't know the size of the array</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This rule doesn&#8217;t check whether the format specifier (defined after the <code>:</code>) is actually valid.</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Invalid string format, the format cannot be null.</p>
</li>
<li>
<p>Invalid string format, unbalanced curly brace count.</p>
</li>
<li>
<p>Invalid string format, opening curly brace can only be followed by a digit or an opening curly brace.</p>
</li>
<li>
<p>Invalid string format, the highest string format item index should not be greater than the arguments count.</p>
</li>
<li>
<p>Invalid string format, format items should comply with the following pattern '{index[,alignment][:formatString]}'.</p>
</li>
<li>
<p>Invalid string format, all format item indexes should be a number.</p>
</li>
<li>
<p>Invalid string format, all format item alignments should be a number.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The format string.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_31_aug_2015_123959_tamas_vajk_wrote">on 31 Aug 2015, 12:39:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Could you check the issue message? I can&#8217;t easily find out the number of placeholders in the format, that&#8217;s why I can&#8217;t use the same as in Python.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_aug_2015_130346_ann_campbell_wrote">on 31 Aug 2015, 13:03:46 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] the message is fine as far as it goes, but it doesn&#8217;t cover something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>var s1 = string.Format("{3}", 1);</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_jan_2016_110513_ann_campbell_wrote">on 18 Jan 2016, 11:05:13 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>This should eventually cover <code>Console.WriteLine</code> (and some others, I&#8217;m told) too.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s3457">relates to: S3457</h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s3941">is related to: S3941</h3>

</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_204330_sébastien_gioria_wrote">on 2 Feb 2015, 20:43:30 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>could fall in OWASP Top10 2013 A6</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_203229_ann_campbell_wrote">on 3 Feb 2015, 20:32:29 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I don&#8217;t understand how [~sebastien.gioria]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_14_jul_2016_180743_ann_campbell_wrote">on 14 Jul 2016, 18:07:43 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] I think https://github.com/google/error-prone/blob/master/docs/bugpattern/FormatString.md has cases not covered here&#8230;&#8203;?</p>
</div>
</div>
</div>
</div>