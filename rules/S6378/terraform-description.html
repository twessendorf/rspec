<div class="paragraph">
<p>Disabling Managed Identities can reduce an organization&#8217;s ability to protect itself against configuration faults and credentials leaks.</p>
</div>
<div class="paragraph">
<p>Authenticating via managed identities to an Azure resource solely relies on an API call with a non-secret token. The process is inner to Azure: Secrets used by Azure are not even accessible to end-users.</p>
</div>
<div class="paragraph">
<p>In typical scenarios without managed identities, the use of credentials can lead to mistakenly leaving them in code bases. In addition, configuration faults may also happen when storing these values or assigning them permissions.</p>
</div>
<div class="paragraph">
<p>By transparently taking care of the Azure Active Directory authentication, Managed Identities allow getting rid of day-to-day credentials management.</p>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This component needs to authenticate to other Azure resources that support Managed Identities.</p>
</li>
<li>
<p>This component accesses these Azure resources by retrieving locally-stored credentials.</p>
</li>
<li>
<p>This component either uses:</p>
<div class="ulist">
<ul>
<li>
<p>A different Access Control system that doesn&#8217;t guarantee the same QoS as Azure Active Directory;</p>
</li>
<li>
<p>Or no Access Control at all.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to all of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable the Managed Identities capabilities of this Azure resource. If supported, use a System-Assigned managed identity, as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It cannot be shared across resources;</p>
</li>
<li>
<p>Its life cycle is deeply tied to the life cycle of its Azure resource;</p>
</li>
<li>
<p>It provides a unique independent identity;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, User-Assigned Managed Identities can also be used but don&#8217;t guarantee the properties listed above.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Typical identity blocks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "azurerm_api_management" "example" { # Sensitive, the identity block is missing
  name           = "example"
  publisher_name = "company"
}</pre>
</div>
</div>
<div class="paragraph">
<p>For connections between Kusto Clusters and Azure Data Factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "azurerm_data_factory_linked_service_kusto" "example" {
  name                 = "example"
  use_managed_identity = false # Sensitive
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Typical identity blocks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "azurerm_api_management" "example" {
  name           = "example"
  publisher_name = "company"

  identity {
    type = "SystemAssigned"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For connections between Kusto Clusters and Azure Data Factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource "azurerm_data_factory_linked_service_kusto" "example" {
  name                 = "example"
  use_managed_identity = true
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A05</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview">Managed Identities Overview</a> - Azure AD Documentation</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identity-best-practice-recommendations">Managed Identities Best Practices</a> - Azure AD Documentation</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities">Services that support managed identities</a> - Azure AD Documentation</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that disabling Azure Managed Identities is safe here.</p>
</div>
</div>
</div>
</div>