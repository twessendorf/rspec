<div class="paragraph">
<p>Shared resources should not be used for locking as it increases the chance of deadlocks. Any other thread could acquire (or attempt to acquire) the same lock for another unrelated purpose.</p>
</div>
<div class="paragraph">
<p>Instead, a dedicated <code>object</code> instance should be used for each shared resource, to avoid deadlocks or lock contention.</p>
</div>
<div class="paragraph">
<p>The following objects are considered as shared resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Me</code></p>
</li>
<li>
<p>a <code>Type</code> object</p>
</li>
<li>
<p>a string literal</p>
</li>
<li>
<p>a string instance</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>Public Sub MyLockingMethod()
    SyncLock Me 'Noncompliant
        ' ...
    End SyncLock
End Sub</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>Class MyClass
    Dim lockObj As New Object()

    Public Sub MyLockingMethod()
        SyncLock lockObj
            ' ...
        End SyncLock
    End Sub
End Class</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/managed-threading-best-practices">Microsoft Documentation: Managed Threading Best Practices</a></p>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Lock on a dedicated object instance instead.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2015_135818_ann_campbell_wrote">on 4 Feb 2015, 13:58:18 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Gendarme DoNotLockOnThisOrTypesRule</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_apr_2015_105021_freddy_mallet_wrote">on 13 Apr 2015, 10:50:21 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>@Tamas, does this rule makes sense to you ? Thanks</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_112042_tamas_vajk_wrote">on 22 May 2015, 11:20:42 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Looks good, I&#8217;ve updated the wording around the <code>Type</code> object</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_120856_ann_campbell_wrote">on 22 May 2015, 12:08:56 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~tamas.vajk]. Looks good.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_jun_2015_124511_tamas_vajk_wrote">on 11 Jun 2015, 12:45:11 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2]: Could you rephrase it according to the following?</p>
</div>
<div class="paragraph">
<p>\[~dinesh.bolkensteyn] made the following remark on this rule in GitHub: "&#8230;&#8203;IMO ideally we&#8217;ll want to show an instance of a real issue.</p>
</div>
<div class="paragraph">
<p>my understanding of the current description is that, as soon as another thread will also lock "this" or the same type, then you will have a deadlock"</p>
</div>
<div class="paragraph">
<p>The problem he raises is that we shouldn&#8217;t lock on <code>this</code> or an instance of <code>Type</code> because it <strong>increases</strong> the chance of running into a synchronization issue.</p>
</div>
<div class="paragraph">
<p>I don&#8217;t thing that we should add a code sample which has a deadlock as the example would be too complex and long.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_jun_2015_152239_ann_campbell_wrote">on 11 Jun 2015, 15:22:39 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>wording massaged. See what you think.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_jun_2015_152333_ann_campbell_wrote">on 11 Jun 2015, 15:23:33 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>FYI [~nicolas.peru]. This was originally written for C# but I&#8217;ve just mapped it to a FB rule.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_jun_2015_152903_tamas_vajk_wrote">on 11 Jun 2015, 15:29:03 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Looks good</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_jun_2015_092406_nicolas_peru_wrote">on 15 Jun 2015, 09:24:06 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I have doubt about how this one actually maps to the findbugs rule mentionned. AFAIU this one is about synchronizing on <code>this</code> whereas the FB rule is about synchronizing on <code>this.getClass()</code> that should be avoided so I think this mapping is not correct.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_jun_2015_135921_ann_campbell_wrote">on 15 Jun 2015, 13:59:21 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru], C#'s <code>this.GetType()</code> is analogous to Java&#8217;s <code>this.getClass()</code>.</p>
</div>
<div class="paragraph">
<p>Does that sway your opinion?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_jun_2015_143247_nicolas_peru_wrote">on 15 Jun 2015, 14:32:47 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Not really, as the fix for the findbugs rule suggest to use the static <code>.class</code> accessor instead of <code>this.getClass()</code> which is synchronized on a type, hence the spirit of the rule is not the same and then mapping is not suitable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_jun_2015_150734_ann_campbell_wrote">on 15 Jun 2015, 15:07:34 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay [~nicolas.peru]. Mapping removed.</p>
</div>
</div>
</div>
</div>