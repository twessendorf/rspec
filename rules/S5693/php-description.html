<div class="paragraph">
<p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in order to prevents DoS attacks.</p>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>size limits are not defined for the different resources of the web application.</p>
</li>
<li>
<p>the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features.</p>
</li>
<li>
<p>the web application infrastructure has limited resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>For most of the features of an application, it is recommended to limit the size of requests to:</p>
<div class="ulist">
<ul>
<li>
<p>lower or equal to 8mb for file uploads.</p>
</li>
<li>
<p>lower or equal to 2mb for other requests.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://symfony.com/doc/current/reference/constraints/File.html#maxsize">Symfony Constraints</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Mapping\ClassMetadata;

class TestEntity
{
    public static function loadValidatorMetadata(ClassMetadata $metadata)
    {
        $metadata-&gt;addPropertyConstraint('upload', new Assert\File([
            'maxSize' =&gt; '100M', // Sensitive
        ]));
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://laravel.com/docs/8.x/validation#rule-max">Laravel Validator</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class TestController extends Controller
{
    public function test(Request $request)
    {
        $validatedData = $request-&gt;validate([
            'upload' =&gt; 'required|file', // Sensitive
        ]);
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://symfony.com/doc/current/reference/constraints/File.html#maxsize">Symfony Constraints</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Mapping\ClassMetadata;

class TestEntity
{
    public static function loadValidatorMetadata(ClassMetadata $metadata)
    {
        $metadata-&gt;addPropertyConstraint('upload', new Assert\File([
            'maxSize' =&gt; '8M', // Compliant
        ]));
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://laravel.com/docs/8.x/validation#rule-max">Laravel Validator</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class TestController extends Controller
{
    public function test(Request $request)
    {
        $validatedData = $request-&gt;validate([
            'upload' =&gt; 'required|file|max:8000', // Compliant
        ]);
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service Cheat Sheet</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/770.html">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/400.html">MITRE, CWE-400</a> - Uncontrolled Resource Consumption</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure the content length limit is safe here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>key = fileUploadSizeLimit</p>
</li>
<li>
<p>Description: The maximum size of HTTP requests handling file uploads (in bytes)</p>
</li>
<li>
<p>Default value: 8000000</p>
</li>
<li>
<p>Type: integer</p>
</li>
<li>
<p>Key: standardSizeLimit</p>
</li>
<li>
<p>Description: The maximum size of regular HTTP requests (in bytes)</p>
</li>
<li>
<p>Default value: 2000000</p>
</li>
<li>
<p>Type: integer</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_17_feb_2021_113517_andrei_epure_wrote">on 17 Feb 2021, 11:35:17 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>\[~pierre-loup.tristant], [~csaba.sagi] - based on googling, I see that 8 MB are 8388608 bytes (<a href="https://convertlive.com/u/convert/megabytes/to/bytes#8">source</a>)</p>
</div>
<div class="paragraph">
<p>Even if we set in the default param to 8000000 to be more readable, internally shouldn&#8217;t we account that people may use the <code>8388608</code> value as well?</p>
</div>
<div class="paragraph">
<p>(sorry, this was meant for the C# flavor, but it&#8217;s relevant for the rule in general)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_feb_2021_142054_pierre_loup_tristant_wrote">on 17 Feb 2021, 14:20:54 Pierre-Loup Tristant wrote:</h3>
<div class="paragraph">
<p>\[~andrei.epure] Yes we should probably use 8388608 to be consistent with the code examples or update the code examples themself. In the other and this is a rather arbitrary limit and it&#8217;s up to the user to make it what he thinks fits the best his application constraints.</p>
</div>
</div>
</div>
</div>