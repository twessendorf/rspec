<div class="paragraph">
<p>Checking that variable X has type T with <a href="https://docs.python.org/3/library/typing.html">type annotations</a> implies that X&#8217;s value is of type T or a subtype of T. After such a check, it is a good practice to limit actions on X to those allowed by type T, even if a subclass of T allows different actions. Doing otherwise will confuse your fellow developers.</p>
</div>
<div class="paragraph">
<p>Just to be clear, it is common in python to perform an action without checking first if it is possible (see <a href="https://docs.python.org/3/glossary.html#term-eafp">"Easier to ask for forgiveness than permission."</a>). However when type checks are performed, they should not contradict the following actions.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when an action performed on a variable might be possible, but it contradicts a previous type check. The list of checked actions corresponds to rules S2159, S3403, S5607, S5756, S5644, S3862, S5797, S5795 and S5632. These other rules only detect cases where the type of a variable is certain, i.e. it cannot be a subclass.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>def add_the_answer(param: str):
    return param + 42  # Noncompliant. Fix this "+" operation; Type annotation on "param" suggest that operands have incompatible types.
    # Note: In practice it is possible to create a class inheriting from both "str" and "int", but this would be a very confusing design.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>def add_the_answer(param: str):
    return param + "42"</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.python.org/3/library/functions.html#isinstance">Python documentation - <code>isinstance</code> function</a></p>
</li>
<li>
<p><a href="https://docs.python.org/3/glossary.html#term-eafp">Python glossary - "Easier to ask for forgiveness than permission."</a></p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Secondary is always:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>message: "Inconsistent type check."</p>
</li>
<li>
<p>location: the last type check giving us information on the variables' type. Ex: an isinstance call.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Primary varies depending on the issue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>s2159 - Equality between incompatible types:</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this equality check; Previous type checks suggest that operands have incompatible types.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s3403 - identity check between incompatible types</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this "is" check; Previous type checks suggest that operands have incompatible types.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s5607 - operations on incompatible types</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this "+" operation; Previous type checks suggest that operands have incompatible types.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s5756 - calling a non-callable type</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this call; Previous type checks suggest that "param" is not callable.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s5644 - calling <code>__getitem__</code> on type which doesn&#8217;t have this method</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this <em>getitem</em> operation; Previous type checks suggest that "param" does not have this method.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s3862 - iteration operation on a non-iterable type</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this unpacking; Previous type checks suggest that "param" is not iterable.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s5795 - identity check relies on interpreter&#8217;s cache</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this condition; Previous type checks suggest that it relies on interpreter&#8217;s cache.</p>
</li>
</ul>
</div>
</li>
<li>
<p>s5632 - <code>raise</code> used with a non-exception type</p>
<div class="ulist">
<ul>
<li>
<p>message: Fix this "raise" statement; Previous type checks suggest that "param" is not an exception.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>