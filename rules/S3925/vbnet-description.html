<div class="paragraph">
<p>The <code>ISerializable</code> interface is the mechanism to control the type serialization process. If not implemented correctly this could result in an invalid serialization and hard to detect bugs.</p>
</div>
<div class="paragraph">
<p>This rules raises an issue on types that implement <code>ISerializable</code> without following the serialization pattern recommended by Microsoft.</p>
</div>
<div class="paragraph">
<p>Specifically this rule checks for these problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>System.SerializableAttribute</code> attribute is missing.</p>
</li>
<li>
<p>Non-serializable fields are not marked with the <code>System.NonSerializedAttribute</code> attribute.</p>
</li>
<li>
<p>There is no serialization constructor.</p>
</li>
<li>
<p>An unsealed type has a serialization constructor that is not <code>protected</code>.</p>
</li>
<li>
<p>A sealed type has a serialization constructor that is not <code>private</code>.</p>
</li>
<li>
<p>An unsealed type has a <code>ISerializable.GetObjectData</code> that is not both <code>public</code> and <code>virtual</code>.</p>
</li>
<li>
<p>A derived type has a serialization constructor that does not call the <code>base</code> constructor.</p>
</li>
<li>
<p>A derived type has a <code>ISerializable.GetObjectData</code> method that does not call the <code>base</code> method.</p>
</li>
<li>
<p>A derived type has serializable fields but the <code>ISerializable.GetObjectData</code> method is not overridden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Classes which inherit from <code>Exception</code> are implementing <code>ISerializable</code>. Make sure <code>[Serializable]</code> attribute is used and that <code>ISerializable</code> is correctly implemented. Even it you don’t plan to explicitly serialize the object yourself, it might still require serialization, for instance when crossing the boundary of an <code>AppDomain</code>.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>public class Foo : ISerializable // Noncompliant the [Serializable] attribute is missing
{
}</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public class Bar
{
}

[Serializable]
public class Foo : ISerializable // Noncompliant the serialization constructor is missing
{
    private readonly Bar bar; // Noncompliant the field is not marked with [NonSerialized]
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>public class Bar
{
}

[Serializable]
public class Foo : ISerializable
{
    [NonSerialized]
    private readonly Bar bar;

    public Foo()
    {
        // ...
    }

    protected Foo(SerializationInfo info, StreamingContext context)
    {
        // ...
    }

    public virtual void GetObjectData(SerializationInfo info, StreamingContext context)
    {
        // ...
    }
}

[Serializable]
public sealed class SubFoo : Foo
{
    private int val;

    public SubFoo()
    {
        // ...
    }

    private SubFoo(SerializationInfo info, StreamingContext context)
        : base(info, context)
    {
        // ...
    }

    public override void GetObjectData(SerializationInfo info, StreamingContext context)
    {
        base.GetObjectData(info, context);
        // ...
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">Exceptions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Classes in test projects are not checked.</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Update this implementation of <code>ISerializable</code> to conform to the recommended serialization pattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The type identifier.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_16_mar_2017_121137_ann_campbell_wrote">on 16 Mar 2017, 12:11:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~amaury.leve] I&#8217;ve edited. Please double-check me.</p>
</div>
<div class="paragraph">
<p>Also, examples for each noncompliant case aren&#8217;t necessary IMO. I&#8217;d show only one or two particularly damaging or particularly subtle examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_mar_2017_160550_valeri_hristov_wrote">on 24 Mar 2017, 16:05:50 Valeri Hristov wrote:</h3>
<div class="paragraph">
<p>The following check is not implemented because it is difficult to know exactly which fields should be marked with <code>NonSerialized</code> and I am afraid it will generate too many FPs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-serializable fields are not marked with the <code>System.NonSerializedAttribute</code> attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We find mostly classes that derive from Exception in the projects we test and that&#8217;s why they might not be a good source for checking issues and false positives (statistically).</p>
</div>
</div>
</div>
</div>