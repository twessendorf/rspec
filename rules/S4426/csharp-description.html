<div class="paragraph">
<p>Most of cryptographic systems require a sufficient key size to be robust against brute-force attacks.</p>
</div>
<div class="paragraph">
<p><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar2.pdf">NIST recommendations</a> will be checked for these use-cases:</p>
</div>
<div class="paragraph">
<p><strong>Digital Signature Generation</strong> and <strong>Verification:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>p ≥ 2048 AND q ≥ 224 for DSA (<code>p</code> is key length and <code>q</code> the modulus length)</p>
</li>
<li>
<p>n ≥ 2048 for  RSA (<code>n</code> is the key length)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Key Agreement</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>p ≥ 2048 AND q ≥ 224 for DH and MQV</p>
</li>
<li>
<p>n ≥ 224 for ECDH and ECMQV  (Examples: <code>secp192r1</code> is a non-compliant curve (<code>n</code> &lt; 224) but <code>secp224k1</code> is compliant (<code>n</code> &gt;= 224))</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Symmetric keys</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>key length ≥ 128 bits</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule will not raise issues for ciphers that are considered weak (no matter the key size) like <code>DES</code>, <code>Blowfish</code>.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>using System;
using System.Security.Cryptography;

namespace MyLibrary
{
    public class MyCryptoClass
    {
        static void Main()
        {
            var dsa1 = new DSACryptoServiceProvider(); // Noncompliant - default key size is 1024
            dsa1.KeySize = 2048; // Noncompliant - the setter does not update the underlying key size for the DSACryptoServiceProvider class

            var dsa2 = new DSACryptoServiceProvider(2048); // Noncompliant - cannot create DSACryptoServiceProvider with a key size bigger than 1024

            var rsa1 = new RSACryptoServiceProvider(); // Noncompliant - default key size is 1024
            rsa1.KeySize = 2048; // Noncompliant - the setter does not update the underlying key size for the RSACryptoServiceProvider class

            var rsa2 = new RSACng(1024); // Noncompliant

            // ...
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>KeySize property of DSACryptoServiceProvider and RSACryptoServiceProvider does not change the value of underlying KeySize for the algorithm. Property setter is ignored without error and KeySize can be changed only by using constructor overload. See:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.dsacryptoserviceprovider.keysize">DSACryptoServiceProvider.KeySize Property</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsacryptoserviceprovider.keysize">RSACryptoServiceProvider.KeySize Property</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>using System;
using System.Security.Cryptography;

namespace MyLibrary
{
    public class MyCryptoClass
    {
        static void Main()
        {
            var dsa1 = new DSACng(); // Compliant - default key size is 2048
            var dsa2 = new DSACng(2048); // Compliant
            var rsa1 = new RSACryptoServiceProvider(2048); // Compliant
            var rsa2 = new RSACng(); // Compliant - default key size is 2048

            // ...
        }
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec Verification Standard</a> - Cryptography Requirements</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> - Insufficient Cryptography</p>
</li>
<li>
<p><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/326.html">MITRE, CWE-326</a> - Inadequate Encryption Strength</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use a key length of at least 'xxx' bits for 'xxx' cipher algorithm.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_3_apr_2018_122944_alexandre_gigleux_wrote">on 3 Apr 2018, 12:29:44 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p><code>Blowfish</code> case is not covered by SonarC# because there is no .NET API to use Blowfish. See: http://www.bouncycastle.org/csharp/</p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecates_s4787">deprecates: S4787</h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s4787">relates to: S4787</h3>

</div>
</div>
</div>