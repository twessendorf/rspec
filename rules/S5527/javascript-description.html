<div class="paragraph">
<p>To establish a SSL/TLS connection not vulnerable to man-in-the-middle attacks, it&#8217;s essential to make sure the server presents the right certificate.</p>
</div>
<div class="paragraph">
<p>The certificate&#8217;s hostname-specific data should match the server hostname.</p>
</div>
<div class="paragraph">
<p>It&#8217;s not recommended to re-invent the wheel by implementing custom hostname verification.</p>
</div>
<div class="paragraph">
<p>TLS/SSL libraries provide built-in hostname verification functions that should be used.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nodejs.org/api/https.html">https</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method',
  checkServerIdentity: function() {} // Noncompliant: hostname is not verified
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
}); // Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/tls.html">tls</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
    secureProtocol: 'TLSv1_2_method',
    checkServerIdentity: function() {}  // Noncompliant: hostname is not verified
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});  // Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.npmjs.com/package/request">request</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let socket = request.get({
    url: 'https://www.example.com',
    secureProtocol: 'TLSv1_2_method',
    checkServerIdentity: function() {}  // Noncompliant: hostname is not verified
});</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nodejs.org/api/https.html">https</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
}); // Compliant: default checkServerIdentity function is secure</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/tls.html">tls</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
    secureProtocol: 'TLSv1_2_method',
    checkServerIdentity: (servername, peer) =&gt; {
        if (servername !== "www.example.com") {
            return new Error ('Error');  // Compliant: there is at least one check
        }
    }
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
}); // Compliant</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.npmjs.com/package/request">request</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let socket = request.get({
    url: 'https://www.example.com/',
    secureProtocol: 'TLSv1_2_method' // Compliant
}); // Compliant:  default checkServerIdentity function is secure</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and Authentication Failures</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec Verification Standard</a> - Network Communication Requirements</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">OWASP Mobile Top 10 2016 Category M3</a> - Insecure Communication</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/297.html">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Enable server hostname verification on this SSL/TLS connection</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>When <code>https.request</code>|<code>request.get</code>|<code>tls.connect</code> is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>primary location: the call to <code>https.request/...</code></p>
</li>
<li>
<p>secondary location: on <code>rejectUnauthorized: false</code></p>
<div class="ulist">
<ul>
<li>
<p>message: 'Set "rejectUnauthorized" to "true".'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s3510">deprecates: S3510</h3>

</div>
<div class="sect2">
<h3 id="_deprecates_s4499">deprecates: S4499</h3>

</div>
<div class="sect2">
<h3 id="_deprecates_s5326">deprecates: S5326</h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s4830">is related to: S4830</h3>

</div>
<div class="sect2">
<h3 id="_on_5_nov_2020_113949_pierre_loup_tristant_wrote">on 5 Nov 2020, 11:39:49 Pierre-Loup Tristant wrote:</h3>
<div class="paragraph">
<p>.NET API offers <a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.security.remotecertificatevalidationcallback">a single callback</a> to override TLS certificates chain and hostname validation. RSPEC-4830 already detects that this callback always accept the server certificate without validation. There is no easy way to detects code that validates the certificate chain and fails to validate the server hostname in this callback.</p>
</div>
<div class="paragraph">
<p>Therefore, this will not be implemented for .NET langauges.</p>
</div>
</div>
</div>
</div>