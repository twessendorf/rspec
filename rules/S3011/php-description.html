<div class="paragraph">
<p>This rule raises an issue when reflection is used to change the visibility of a class, method or field, and when it is used to directly update a field value. Altering or bypassing the accessibility of classes, methods, or fields violates the encapsulation principle and could lead to run-time errors.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>class MyClass
{
    public static $publicstatic = 'Static';
    private static $privatestatic = 'private Static';
    private $private = 'Private';
    private const CONST_PRIVATE = 'Private CONST';
    public $myfield = 42;

    private function __construct() {}
    private function privateMethod() {}
    public function __set($property, $value)  {}
    public function __get($property) {}
}

$clazz = new ReflectionClass('MyClass');

$clazz-&gt;getstaticProperties(); // Noncompliant . This gives access to private static properties

$clazz-&gt;setStaticPropertyValue('publicstatic', '42'); // OK as there is no overloading to bypass and it respects access control.
$clazz-&gt;getStaticPropertyValue('publicstatic'); // OK as there is no overloading to bypass and it respects access control.

// The following calls can access private or protected constants.
$clazz-&gt;getConstant('CONST_PRIVATE'); // Noncompliant.
$clazz-&gt;getConstants(); // Noncompliant.
$clazz-&gt;getReflectionConstant('CONST_PRIVATE'); // Noncompliant.
$clazz-&gt;getReflectionConstants(); // Noncompliant.

$obj = $clazz-&gt;newInstanceWithoutConstructor(); // Noncompliant. Bypassing private constructor.

$constructor = $clazz-&gt;getConstructor();
$constructorClosure = $constructor-&gt;getClosure($obj); // Noncompliant. It is possible to call private methods with closures.
$constructor-&gt;setAccessible(true); // Noncompliant. Bypassing constructor accessibility.

$prop = new ReflectionProperty('MyClass', 'private');
$prop-&gt;setAccessible(true); // Noncompliant. Change accessibility of a property.
$prop-&gt;setValue($obj, "newValue"); // Noncompliant. Bypass of the __set method.
$prop-&gt;getValue($obj); // Noncompliant. Bypass of the __get method.

$prop2 = $clazz-&gt;getProperties()[2];
$prop2-&gt;setAccessible(true); // Noncompliant. Change accessibility of a property.
$prop2-&gt;setValue($obj, "newValue"); // Noncompliant. Bypass of the __set method.
$prop2-&gt;getValue($obj); // Noncompliant. Bypass of the __get method.

$meth = new ReflectionMethod('MyClass', 'privateMethod');
$clos = $meth-&gt;getClosure($obj); // Noncompliant. It is possible to call private methods with closures.
$meth-&gt;setAccessible(true); // Noncompliant. Change accessibility of a method.

$meth2 = $clazz-&gt;getMethods()[0];
$clos2 = $meth2-&gt;getClosure($obj); // Noncompliant. It is possible to call private methods with closures.
$meth2-&gt;setAccessible(true); // Noncompliant. Change accessibility of a method.

// Using a ReflectionObject instead of the class

$objr = new ReflectionObject($obj);
$objr-&gt;newInstanceWithoutConstructor(); // Noncompliant. Bypassing private constructor.

$objr-&gt;getStaticPropertyValue("publicstatic"); // OK as there is no overloading to bypass and it respects access control.
$objr-&gt;setStaticPropertyValue("publicstatic", "newValue"); // OK as there is no overloading to bypass and it respects access control.

$objr-&gt;getStaticProperties(); // Noncompliant. This gives access to private static properties

// The following calls can access private or protected constants.
$objr-&gt;getConstant('CONST_PRIVATE'); // Noncompliant.
$objr-&gt;getConstants(); // Noncompliant.
$objr-&gt;getReflectionConstant('CONST_PRIVATE'); // Noncompliant.
$objr-&gt;getReflectionConstants(); // Noncompliant.

$constructor = $objr-&gt;getConstructor();
$constructorClosure = $constructor-&gt;getClosure($obj); // Noncompliant. It is possible to call private methods with closures.
$constructor-&gt;setAccessible(true); // Noncompliant. Bypassing constructor accessibility.

$prop3 = $objr-&gt;getProperty('private');
$prop3-&gt;setAccessible(true); // Noncompliant. Change accessibility of a property.
$prop3-&gt;setValue($obj, "newValue"); // Noncompliant. Bypass of the __set method.
$prop3-&gt;getValue($obj); // Noncompliant. Bypass of the __get method.

$prop4 = $objr-&gt;getProperties()[2];
$prop4-&gt;setAccessible(true); // Noncompliant. Change accessibility of a property.
$prop4-&gt;setValue($obj, "newValue"); // Noncompliant. Bypass of the __set method.
$prop4-&gt;getValue($obj); // Noncompliant. Bypass of the __get method.

$meth3 = $objr-&gt;getMethod('privateMethod');
$clos3 = $meth3-&gt;getClosure($obj); // Noncompliant. It is possible to call private methods with closures.
$meth3-&gt;setAccessible(true); // Noncompliant. Change accessibility of a method.

$meth4 = $objr-&gt;getMethods()[0];
$clos4 = $meth4-&gt;getClosure($obj); // Noncompliant. It is possible to call private methods with closures.
$meth4-&gt;setAccessible(true); // Noncompliant. Change accessibility of a method.</pre>
</div>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>This accessibility [update|bypass] should be removed.</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_23_jul_2015_071531_nicolas_peru_wrote">on 23 Jul 2015, 07:15:31 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>Not sure if it should be part of the description but it is not really clear if the rule is limited to the API in the example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_jul_2015_090519_ann_campbell_wrote">on 23 Jul 2015, 09:05:19 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>FYI [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_19_apr_2018_105330_alexandre_gigleux_wrote">on 19 Apr 2018, 10:53:30 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>This is a "Security Weakness".</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_sep_2018_102809_alexandre_gigleux_wrote">on 4 Sep 2018, 10:28:09 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.harraudeau] Review</p>
</div>
<div class="paragraph">
<p>I think you should ask yourself if this rule is only relevant for Java. If this is the case, it is no longer a Common Security Hotspot rule.</p>
</div>
<div class="paragraph">
<p>Check if C#, VB.Net are really excluded, I don&#8217;t think so. Also I believe PHP, Swift, Scala, Kotlin, Ruby should be in the list of Targeted Languages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_sep_2018_112931_nicolas_harraudeau_wrote">on 4 Sep 2018, 11:29:31 Nicolas Harraudeau wrote:</h3>
<div class="paragraph">
<p>\[~alexandre.gigleux] Thanks for the review</p>
</div>
<div class="paragraph">
<p>Here are examples for the targeted languages: https://rosettacode.org/wiki/Break_OO_privacy</p>
</div>
<div class="paragraph">
<p>Ruby is a special case.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_6_apr_2020_120104_eric_therond_wrote">on 6 Apr 2020, 12:01:04 Eric Therond wrote:</h3>
<div class="paragraph">
<p>Altering accessibility at run-time is not possible if a security manager is configured (in Java) or the code doesn&#8217;t have the right permission (<a href="https://docs.microsoft.com/fr-fr/dotnet/framework/reflection-and-codedom/security-considerations-for-reflection">in C#</a>).</p>
</div>
<div class="paragraph">
<p>So a new security-hotspot rule could be relevant in the future to detect when a loose permission is granted that allow, for instance, external code to change accessibility of fields of a trusted code and thus access to private information, however here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The rule raises when the accessibility is changed, so basically "the consequence" and not the root cause of the bug is highlighted.</p>
</li>
<li>
<p>Reflection will be most of the times used to create dynamic types or to perform debugging.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So a code smell is more appropriate than a security rule.</p>
</div>
</div>
</div>
</div>