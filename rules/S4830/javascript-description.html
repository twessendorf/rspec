<div class="paragraph">
<p>Validation of X.509 certificates is essential to create secure SSL/TLS sessions not vulnerable to man-in-the-middle attacks.</p>
</div>
<div class="paragraph">
<p>The certificate chain validation includes these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The certificate is issued by its parent Certificate Authority or the root CA trusted by the system.</p>
</li>
<li>
<p>Each CA is allowed to issue certificates.</p>
</li>
<li>
<p>Each certificate in the chain is not expired.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s not recommended to reinvent the wheel by implementing custom certificate chain validation.</p>
</div>
<div class="paragraph">
<p>TLS libraries provide built-in certificate validation functions that should be used.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is no way to disable certificate verification in tls, https and request modules but it is possible to not reject request when verification fails.</p>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/https.html">https</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method',
  rejectUnauthorized: false ; // Noncompliant
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
}); // Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/tls.html">tls</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
    secureProtocol: 'TLSv1_2_method',
    rejectUnauthorized: false ; // Noncompliant
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});  // Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.npmjs.com/package/request">request</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let socket = request.get({
    url: 'www.example.com',
    secureProtocol: 'TLSv1_2_method',
    rejectUnauthorized: false ; // Noncompliant
});</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nodejs.org/api/https.html">https</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
}); // Compliant: by default rejectUnauthorized  is set to true</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/tls.html">tls</a> built-in module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let options = {
    secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
}); // Compliant: by default rejectUnauthorized  is set to true</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.npmjs.com/package/request">request</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let socket = request.get({
    url: 'https://www.example.com/',
    secureProtocol: 'TLSv1_2_method' // Compliant
}); // Compliant: by default rejectUnauthorized  is set to true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and Authentication Failures</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec Verification Standard</a> - Network Communication Requirements</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">OWASP Mobile Top 10 2016 Category M3</a> - Insecure Communication</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/295.html">MITRE, CWE-295</a> - Improper Certificate Validation</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Enable server certificate validation on this SSL/TLS connection</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>When <code>request.get/post/...</code> is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>primary location: the call to <code>request.get/post/...</code></p>
</li>
<li>
<p>secondary location: on <code>rejectUnauthorized: false</code></p>
<div class="ulist">
<ul>
<li>
<p>message: 'Set "rejectUnauthorized" to "true".'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s4424">deprecates: S4424</h3>

</div>
<div class="sect2">
<h3 id="_deprecates_s5326">deprecates: S5326</h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s5527">relates to: S5527</h3>

</div>
</div>
</div>