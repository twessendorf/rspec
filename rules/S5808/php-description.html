<div class="paragraph">
<p>Authorizations granted or not to users to access resources of an application should be based on strong decisions. For instance, checking whether the user is authenticated or not, has the right roles/privileges. It may also depend on the user&#8217;s location, or the date, time when the user requests access.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Symfony web application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>vote</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">VoterInterface</a> type is not compliant when it returns only an affirmative decision (<code>ACCESS_GRANTED</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>class NoncompliantVoterInterface implements VoterInterface
{
    public function vote(TokenInterface $token, $subject, array $attributes)
    {
        return self::ACCESS_GRANTED; // Noncompliant
    }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>voteOnAttribute</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">Voter</a> type is not compliant when it returns only an affirmative decision (<code>true</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>class NoncompliantVoter extends Voter
{
    protected function supports(string $attribute, $subject)
    {
        return true;
    }

    protected function voteOnAttribute(string $attribute, $subject, TokenInterface $token)
    {
        return true; // Noncompliant
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In a Laravel web application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>define</code>, <code>before</code>, and <code>after</code> methods of a <a href="https://laravel.com/docs/8.x/authorization">Gate</a> are not compliant when they return only an affirmative decision (<code>true</code> or <code>Response::allow()</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>class NoncompliantGuard
{
    public function boot()
    {
        Gate::define('xxx', function ($user) {
            return true; // Noncompliant
        });

        Gate::define('xxx', function ($user) {
            return Response::allow(); // Noncompliant
        });
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Symfony web application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>vote</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">VoterInterface</a> type should return a negative decision (<code>ACCESS_DENIED</code>) or abstain from making a decision (<code>ACCESS_ABSTAIN</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>class CompliantVoterInterface implements VoterInterface
{
    public function vote(TokenInterface $token, $subject, array $attributes)
    {
        if (foo()) {
            return self::ACCESS_GRANTED; // Compliant
        } else if (bar()) {
            return self::ACCESS_ABSTAIN;
        }
        return self::ACCESS_DENIED;
    }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>voteOnAttribute</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">Voter</a> type should return a negative decision (<code>false</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>class CompliantVoter extends Voter
{
    protected function supports(string $attribute, $subject)
    {
        return true;
    }

    protected function voteOnAttribute(string $attribute, $subject, TokenInterface $token)
    {
        if (foo()) {
            return true; // Compliant
        }
        return false;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In a Laravel web application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>define</code>, <code>before</code>, and <code>after</code> methods of a <a href="https://laravel.com/docs/8.x/authorization">Gate</a> should return a negative decision (<code>false</code> or <code>Response::deny()</code>) or abstain from making a decision (<code>null</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>class NoncompliantGuard
{
    public function boot()
    {
        Gate::define('xxx', function ($user) {
            if (foo()) {
                return true; // Compliant
            }
            return false;
        });

        Gate::define('xxx', function ($user) {
            if (foo()) {
                return Response::allow(); // Compliant
            }
            return Response::deny();
        });
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control">OWASP Top 10 2017 Category A5</a> - Boken Access Control</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/285.html">MITRE, CWE-285</a> - Improper Authorization</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Vote methods should return at least once a negative response</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>\[vote|voteOnAttribute|Gate::define|Gate::before|Gate::after] method name</p>
</div>
</div>
</div>
</div>