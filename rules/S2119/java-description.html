<div class="paragraph">
<p>Creating a new <code>Random</code> object each time a random value is needed is inefficient and may produce numbers which are not random depending on the JDK. For better efficiency and randomness, create a single <code>Random</code>, then store, and reuse it.</p>
</div>
<div class="paragraph">
<p>The <code>Random()</code> constructor tries to set the seed with a distinct value every time. However there is no guarantee that the seed will be random or even uniformly distributed. Some JDK will use the current time as seed, which makes the generated numbers not random at all.</p>
</div>
<div class="paragraph">
<p>This rule finds cases where a new <code>Random</code> is created each time a method is invoked and assigned to a local random variable.</p>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>public void doSomethingCommon() {
  Random rand = new Random();  // Noncompliant; new instance created with each invocation
  int rValue = rand.nextInt();
  //...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>private Random rand = SecureRandom.getInstanceStrong();  // SecureRandom is preferred to Random

public void doSomethingCommon() {
  int rValue = this.rand.nextInt();
  //...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A class which uses a <code>Random</code> in its constructor or in a static <code>main</code> function and nowhere else will be ignored by this rule.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Save and re-use this "Random".</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_8_oct_2014_181047_ann_campbell_wrote">on 8 Oct 2014, 18:10:47 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] to what degree do we see/pay attention to "run once" annotations during analysis, e.g. @PostConstruct?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_191436_nicolas_peru_wrote">on 22 Oct 2014, 19:14:36 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>At the moment : none.</p>
</div>
<div class="paragraph">
<p>So this rule won&#8217;t detect that your random object is initialized in an init method.</p>
</div>
<div class="paragraph">
<p>It might makes more sense to actually detect Random local variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_194032_ann_campbell_wrote">on 22 Oct 2014, 19:40:32 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] you mean local <code>Random</code> variables, right? :-)</p>
</div>
<div class="paragraph">
<p>(I did actually have to read that twice &amp; note the capital letter to understand your meaning :-) )</p>
</div>
<div class="paragraph">
<p>I&#8217;d say that as written, this rule is about local <code>Random</code>s (did you assign it back to me because you don&#8217;t agree?), but I was hoping to be able to make it smarter. Oh well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_aug_2018_182835_nicolas_harraudeau_wrote">on 15 Aug 2018, 18:28:35 Nicolas Harraudeau wrote:</h3>
<div class="paragraph">
<p>This RSPEC is for now limited to detecting local variables of type <code>java.util.Random</code>.</p>
</div>
<div class="paragraph">
<p>It could later cover cases where the Random object is not even assigned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(new Random()).nextInt()</pre>
</div>
</div>
</div>
</div>
</div>