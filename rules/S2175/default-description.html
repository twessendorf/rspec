<div class="paragraph">
<p>The <code>java.util.Collection</code> API has methods that accept <code>Object</code> parameters such as <code>Collection.remove(Object o)</code>, and <code>Collection.contains(Object o)</code>. When the actual type of the object provided to these methods is not consistent with the type declared on the <code>Collection</code> instantiation, those methods will always return <code>false</code> or <code>null</code>. This is most likely unintended and hides a design problem.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when the type of the argument of the following APIs is unrelated to the type used for the <code>Collection</code> declaration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Collection.remove(Object o)</code></p>
</li>
<li>
<p><code>Collection.removeAll(Collection&lt;?&gt;)</code></p>
</li>
<li>
<p><code>Collection.contains(Object o)</code></p>
</li>
<li>
<p><code>List.indexOf(Object o)</code></p>
</li>
<li>
<p><code>List.lastIndexOf(Object o)</code></p>
</li>
<li>
<p><code>Map.containsKey(Object key)</code></p>
</li>
<li>
<p><code>Map.containsValue(Object value)</code></p>
</li>
<li>
<p><code>Map.get(Object key)</code></p>
</li>
<li>
<p><code>Map.getOrDefault(Object key, V defaultValue)</code></p>
</li>
<li>
<p><code>Map.remove(Object key)</code></p>
</li>
<li>
<p><code>Map.remove(Object key, Object value)</code></p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>public class S2175 {

  public static void main(String[] args) {
    String foo = "42";
    Map&lt;Integer, Object&gt; map = new HashMap&lt;&gt;();
    map.remove(foo); // Noncompliant; will return 'null' for sure because 'map' is handling only Integer keys

    // ...

    List&lt;String&gt; list = new ArrayList&lt;String&gt;();
    Integer integer = Integer.valueOf(1);
    if (list.contains(integer)) { // Noncompliant; always false.
      list.remove(integer); // Noncompliant; list.add(integer) doesn't compile, so this will always return 'false'
    }
  }

}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/uDdGBQ">CERT, EXP04-J.</a> - Do not pass arguments to certain Java Collections Framework methods that are a different type than the collection parameter type</p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>A "[class]&lt;[type]&gt;" cannot contain a "[ytype]".</p>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_5_feb_2015_174414_michael_gumowski_wrote">on 5 Feb 2015, 17:44:14 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>As I am currently encountering difficulties implementing the rule, I think that expressly mentioning the names of the variables in the issue message does not worth the effort.</p>
</div>
<div class="paragraph">
<p>Indeed, gathering the names of the variables to build a the proposed message imply several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is costly (and complex) in terms of operations to gather them, and does not provides a lot of information (the issue is already detected on the line, it should not be hard to locate the issue);</p>
</li>
<li>
<p>Variables are not always present in expressions manipulating these methods, implying that multiple messages are possible (increasing complexity of the rule as well). As shown in the following code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>List&lt;String&gt; getList() {
  return new ArrayList&lt;String&gt;();
}

Integer getIntegerValue() {
  return Integer.valueOf(1);
}

void myMethod() {
  if (getList().contains(getIntegerValue())) {  // Noncompliant. Always false.  &lt;&lt;-- What would be the message
    getList().remove(getIntegerValue()); // Noncompliant. list.add(iger) doesn't compile, so this will always return false  &lt;&lt;-- Same problem
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>I would like to change the message to the following proposition, which I think is much simpler without loosing its pertinence:</p>
</div>
<div class="paragraph">
<p><em><em>_{code}"[class]&lt;[type]&gt;" will not contain any "[ytype]"{code}</em>_</em></p>
</div>
<div class="paragraph">
<p>For the previous examples we would then have the syme following message :</p>
</div>
<div class="paragraph">
<p><em><em>_"List&lt;String&gt;" will not contain any "Integer"</em>_</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_feb_2015_184055_ann_campbell_wrote">on 5 Feb 2015, 18:40:55 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski] how about</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A "[class]&lt;[type]&gt;" cannot contain a "[ytype]".</p>
</li>
<li>
<p>You cannot add a "[ytype]" to a "[class]&lt;[type]&gt;".</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_6_feb_2015_074326_michael_gumowski_wrote">on 6 Feb 2015, 07:43:26 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>I&#8217;ll take your first proposition if it&#8217;s ok for you!</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_nov_2018_200203_jens_bannmann_wrote">on 16 Nov 2018, 20:02:03 Jens Bannmann wrote:</h3>
<div class="paragraph">
<p>The first paragraph of the rule description ends in an incomplete sentence, and it is redundant with the second and third paragraphs. Is it a leftover from revising it, or is there some kind of rendering error here in Jira?</p>
</div>
<div class="paragraph">
<p>____A couple Collection methods can be called with arguments of an incorrect type, but doing so is pointless and likely the result of using the wrong argument. This rule will raise an issue</p>
</div>
<div class="paragraph">
<p>The java.util.Collection API is having methods accepting Object as parameter such as Collection.remove(Object o) or Collection.contains(Object o). When the effective type of the object provided to these methods is not consistent with the type declared on the Collection instantiation, those methods will always return false or null. This is most likely unintended and hide a design problem.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when the type of the argument of the following APIs is unrelated to the type used for the Collection declaration:</p>
</div>
<div class="paragraph">
<p>(&#8230;&#8203;)<em>__</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_nov_2018_220959_alexandre_gigleux_wrote">on 16 Nov 2018, 22:09:59 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~bannmann] Fixed</p>
</div>
</div>
</div>
</div>