<div class="paragraph">
<p>When using Spring proxies, calling a method in the same class (e.g. <code>this.aMethod()</code>) with an incompatible <code>@Transactional</code> requirement will result in runtime exceptions because Spring only "sees" the caller and makes no provisions for properly invoking the callee.</p>
</div>
<div class="paragraph">
<p>Therefore, certain calls should never be made within the same class:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">From</th>
<th class="tableblock halign-center valign-top">To</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">non-<code>@Transactional</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">NEVER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">NOT_SUPPORTED</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">REQUIRED or <code>@Transactional</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">REQUIRES_NEW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">SUPPORTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>@Override
public void doTheThing() {
  // ...
  actuallyDoTheThing();  // Noncompliant
}

@Override
@Transactional
public void actuallyDoTheThing() {
  // ...
}</pre>
</div>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>"xxx&#8217;s" @Transactional requirement is incompatible with the one for this method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>primary: method call</p>
</li>
<li>
<p>secondary:</p>
<div class="ulist">
<ul>
<li>
<p>calling method&#8217;s <code>@Transactional</code> annotation or, if none, calling method signature.</p>
</li>
<li>
<p>called method&#8217;s <code>@Transactional</code> annotation or signature</p>
</li>
<li>
<p>message: "Incompatible method definition."</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2014_122950_freddy_mallet_wrote">on 21 Nov 2014, 12:29:50 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>I would tag this rule with the label "spring"</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jun_2018_143900_alban_auzeill_wrote">on 20 Jun 2018, 14:39:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>@Ann I don&#8217;t understand why there&#8217;s a difference between <code>@Transactional</code>  and <code>@Transactional(propagation = Propagation.REQUIRED)</code> (the default) ?</p>
</div>
<div class="paragraph">
<p>And I disagree with incompatible propagations list, this is my proposal:</p>
</div>
<div class="paragraph">
<p>||From||To||</p>
</div>
<div class="paragraph">
<p>| non-<code>@Transactional</code> | MANDATORY, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| MANDATORY | NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| NESTED | MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| NEVER | MANDATORY, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| NOT_SUPPORTED | MANDATORY, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| REQUIRED or <code>@Transactional</code> | NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| REQUIRES_NEW | NESTED, NEVER, NOT_SUPPORTED REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| SUPPORTS | MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>javadoc <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Propagation.html">org.springframework.transaction.annotation.Propagation</a></p>
</div>
<div class="paragraph">
<p>javadoc <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Transactional.html">javax.transaction.Transactional</a></p>
</div>
</div>
</div>
</div>